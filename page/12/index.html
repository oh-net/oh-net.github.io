<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-cn">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="$$ Welcome $$">
<meta property="og:type" content="website">
<meta property="og:title" content="Technician">
<meta property="og:url" content="https://www.cobsun.com/page/12/index.html">
<meta property="og:site_name" content="Technician">
<meta property="og:description" content="$$ Welcome $$">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Technician">
<meta name="twitter:description" content="$$ Welcome $$">






  <link rel="canonical" href="https://www.cobsun.com/page/12/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Technician</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Technician</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Yet another note</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>Sitemap</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/04/19/yaf-e4-bd-bf-e7-94-a8-e6-b3-a8-e6-84-8f-e4-ba-8b-e9-a1-b9/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/19/yaf-e4-bd-bf-e7-94-a8-e6-b3-a8-e6-84-8f-e4-ba-8b-e9-a1-b9/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">Yaf 使用注意事项</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-19 09:13:14" itemprop="dateCreated datePublished" datetime="2017-04-19T09:13:14+08:00">2017-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:24:02" itemprop="dateModified" datetime="2018-12-12T17:24:02+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="配置文件格式"><a href="#配置文件格式" class="headerlink" title="配置文件格式"></a>配置文件格式</h3><p>需要仔细校对，第二个section中的<code>product</code>是和 php.ini 中的 <strong><code>yaf.envrion</code></strong> 配置项的值对应。并且common 节一定要继承自 common section，否则需要把common section 的配置写到 product 中。 如果 php.ini 中 yaf.use_namespace:设置为1的话，表示开启了命名空间（默认不开启），则在读取配置文件时，也要相应的在前面加上命名空间的名称（比如Yaf_Application要变成YafApplication），否则会提示 <code>Class &#39;Yaf_Application&#39; not found</code></p>
<pre><code>[ps2id id=&apos;configure_struct&apos; target=&apos;&apos;/]
[common]
application.directory = APPLICATION_PATH  &quot;/application&quot;
application.dispatcher.catchException = TRUE

[dev : common]
database.dsn = &apos;mysql:host=127.0.0.1;dbname=test&apos;
database.host = &apos;localhost&apos;
database.user = &apos;db_user&apos;
database.pwd = &apos;db_password&apos;
</code></pre><h3 id="配置文件调用示例"><a href="#配置文件调用示例" class="headerlink" title="配置文件调用示例"></a>配置文件调用示例</h3><p>Model 用于提供数据访问的各种方法，这里示例是在 /application/models/User.php 下面</p>
<pre><code>private $conf = null;
function __construct()
{
    $this-&gt;conf = Yaf_Application::app()-&gt;getConfig();
}

/**
 * List 10 Users
 */
function listUser(){
    $arr_users = array();

    $dsn = $this-&gt;conf-&gt;database-&gt;dsn;
    $db_user = $this-&gt;conf-&gt;database-&gt;user;
    $db_pwd = $this-&gt;conf-&gt;database-&gt;pwd;
    $sql = &apos;select email,password from users limit 10&apos;;
    try{
        $pdo = new PDO($dsn,$db_user,$db_pwd);
        if ($pdo){
            $stmt = $pdo-&gt;prepare($sql);
            $stmt-&gt;execute();
            $arr_data = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
            foreach ($arr_data as $datum){
                $arr_users[] = array(
                    &apos;email&apos;=&gt;$datum[&apos;email&apos;],
                    &apos;pwd&apos;=&gt;$datum[&apos;pwd&apos;],
                );
            }
        }
    }catch (PDOException $exception){
        throw  new PDOException(&apos;PDO Exception: &apos; . $exception-&gt;getMessage());
    }catch (Exception $exception){
        throw new Exception(&apos;Unknowing Exception: &apos; . $exception-&gt;getMessage());
    }

    return $arr_users;
}
</code></pre><hr>
<h3 id="调用外部-第三方类库"><a href="#调用外部-第三方类库" class="headerlink" title="调用外部/第三方类库"></a>调用外部/第三方类库</h3><p><strong>示例一</strong></p>
<pre><code>// 导入： yafoo/application/Bootstrap.php
    public function _initLoader($dispatcher){
        $loader = Yaf_Loader::getInstance();
        $loader::import(APPLICATION_PATH . &apos;/application/library/Requests/Requests.php&apos;);
    }

    // 调用时： 
    $response = Requests::get(&apos;http://www.baidu.com/?s=&apos;.$key);
</code></pre><p><strong>示例二</strong></p>
<pre><code>// Boostrap.php
$loader::import(APPLICATION_PATH . &apos;/application/library/Raven/Client.php&apos;);
Raven_Autoloader::register();

// 调用时
function someAction(){
    // code ...
    // code ....
    try{
        // some code ...
    } catch (PDOException $exception) {
        $sentry_client = new Raven_Client($sentry_url);
        $sentry_client-&gt;captureException($exception,array(
            &apos;extra&apos;=&gt;array(
                &apos;php_version&apos;=&gt;phpversion(),
                &apos;environment&apos;=&gt;Yaf_Application::app()-&gt;environ(),
            )
        ));

        throw  new PDOException(&apos;PDO Exception: &apos; . $exception-&gt;getMessage());
    }
}
</code></pre><hr>
<p><strong>如何设置多个models路径</strong></p>
<blockquote>
<p>models, controllers都支持下划线分割, 比如, 如果你是多个modules的不同model, 那么可以命名为 A_B_CModel 那么就会在models目录下的A目录的B目录里面找C</p>
</blockquote>
<h2 id="yaf控制器使用"><a href="#yaf控制器使用" class="headerlink" title="yaf控制器使用"></a>yaf控制器使用</h2><p>控制器方法 - 对用户可见的方法(即用户可以直接访问的方法)需要加上Action后缀 - 初始化类的方法为init，不是__construct</p>
<h3 id="独立文件定义操作-方法"><a href="#独立文件定义操作-方法" class="headerlink" title="独立文件定义操作(方法)"></a>独立文件定义操作(方法)</h3><p><strong>1、作用：为了分解大的控制器，让代码更加清晰</strong> <strong>2、使用方法</strong> <strong>（1）在控制器中绑定操作(即将操作绑定到某个操作类上)</strong></p>
<pre><code>class TestController extends YafController_Abstract
{
    public $actions = array(
        &apos;index&apos;=&gt;&apos;actions/index.php&apos;,
        &apos;add&apos;=&gt;&apos;actions/add.php&apos;,
        &apos;detail&apos;=&gt;&apos;actions/detail.php&apos;  
    );
}
</code></pre><p><strong>（2）定义操作类</strong></p>
<pre><code>class DetailAction extends YafAction_Abstract
{
    public function execute()
    {
        var_dump($this-&gt;getRequest()-&gt;getParam(&apos;id&apos;));
    }
}
</code></pre><p><strong>3、定义操作类</strong></p>
<ul>
<li>- 操作类位置：一般在application/actions下面，如detail.php(application/actions/detail.php)</li>
<li>- 操作类命名：必须以Action为后缀，如DetailAction</li>
<li>- 继承：继承自YafAction_abstract</li>
<li>- 必须实现的方法：execute,因为其父类YafAction_abstract是一个抽象类，必须实现抽象方法execute</li>
<li>- 可以使用的父类方法：不仅可以使用YafAction_abstract的方法，还可以继承YafController_Abstract的方法(因为YafAction_abstract继承自YafController_Abstract)</li>
</ul>
<h3 id="三、控制器基类YafController-Abstract"><a href="#三、控制器基类YafController-Abstract" class="headerlink" title="三、控制器基类YafController_Abstract"></a>三、控制器基类YafController_Abstract</h3><p><strong>1、初始化操作</strong></p>
<ul>
<li>- init:初始化操作(如初始化实例变量，在yaf中替代__construct的功能)</li>
<li>- initView:初始化视图</li>
</ul>
<p><strong>2、视图相关操作</strong></p>
<ul>
<li>(1)getViewpath:获取视图文件目录，默认在application/views下面，也可以通过setViewpath设置修改</li>
<li>(2)setViewpath:设置视图文件目录</li>
<li>(3)getView:获取当前视图对象</li>
<li>(4)display:渲染一个视图模板, 并直接输出给请求端</li>
<li>(5)render:渲染视图模板, 得到渲染结果</li>
</ul>
<p><strong>3、获取请求与响应对象</strong></p>
<ul>
<li>- getRequest:获取当前请求对象，那么它就可以调用request对象所有的方法</li>
<li><p>- getResponse:获取当前响应对象，那么它就可以调用response对象所有的方法</p>
<p>class TestController extends YafController_Abstract</p>
<pre><code>{
    public function testAction()
    {
        $id = $this-&gt;getRequest()-&gt;getParam(&apos;id&apos;);
        $response = $this-&gt;getResponse();
        $response-&gt;setHeader(&apos;content-type&apos;, &apos;application/json&apos;);
        $json = json_encode(array(&apos;id&apos;=&gt;$id, &apos;message&apos;=&gt;&apos;success&apos;));
        $response-&gt;setBody($json);
        //$response-&gt;response();
    }
}
</code></pre></li>
</ul>
<p>注：在浏览器中输入：<a href="http://www.domain.com/test/test/id/123，即可输出：{&quot;id&quot;:&quot;123&quot;,&quot;message&quot;:&quot;success&quot;}" target="_blank" rel="noopener">http://www.domain.com/test/test/id/123，即可输出：{&quot;id&quot;:&quot;123&quot;,&quot;message&quot;:&quot;success&quot;}</a> <strong>4、获取当前请求相关的参数</strong> - getModuleName:获取当前模块名(如果想获取当前控制器名或方法名，可以使用request对象来获取) 获取当前路由参数的简写方式：</p>
<pre><code>public function testAction($name, $id)
{
        echo $name;        //相当于echo $this-&gt;getRequest()-&gt;getParam(&apos;name&apos;);
        echo $id;          //相当于echo $this-&gt;getRequest()-&gt;getParam(&apos;id&apos;);
}
</code></pre><p>在浏览器中输入：<a href="http://www.doamin.com/test/test/id/123/name/shixinke" target="_blank" rel="noopener">http://www.doamin.com/test/test/id/123/name/shixinke</a> 得到输出内容：shixinke 123 <strong>5、页面跳转</strong> - forword : 跳转到某个控制器的某个方法，不会立即跳转，会继续执行它后面的内容 - redirect : 跳转到一个uri 例如：登录的权限控制 <strong>(1)使用forward</strong></p>
<pre><code>class IndexController extends YafController_Abstract
{
    public function indexAction(){   
         $logined = $_SESSION[&quot;userId&quot;];
         if (!$logined) {
             $this-&gt;forward(&quot;login&quot;, array(&quot;from&quot; =&gt; &quot;Index&quot;)); // 跳转到当前模块的login操作
             return FALSE;  //立即返回就不会执行后面的内容了
         }

         //显示内容
    }

    public function loginAction() {
         echo &quot;login, redirected from &quot;, $this-&gt;_request-&gt;getParam(&quot;from&quot;) , &quot; action&quot;;
    }
}
?&gt;
</code></pre><p>注:如果要跳转到其他模块，$this-&gt;forward(‘admin’, ‘login’, ‘index’, array(‘from’=&gt;’index’)); //跳转到admin模块的login控制器的index方法 <strong>(2)使用redirect</strong></p>
<pre><code>public function IndexAction()
{
    $logined = $_SESSION[&apos;userId&apos;];
    if (!$logined) {
    $this-&gt;redirect(&apos;http://www.domain.com/admin/login/index&apos;)); // 跳转到http://www.domain.com/admin/login/index这个地址
    return FALSE;  //立即返回就不会执行后面的内容了
    }

}
</code></pre><h3 id="四、错误处理"><a href="#四、错误处理" class="headerlink" title="四、错误处理"></a>四、错误处理</h3><p><strong>1、通过ErrorController这个控制器来捕获异常与错误</strong> 首先得在启动文件中开启异常捕获：</p>
<pre><code>YafDispatcher::getInstance()-&gt;catchException(true);
</code></pre><p>错误控制器：</p>
<pre><code>    class ErrorController extends YafController_Abstract
    {
        /**
         * 也可通过$request-&gt;getException()获取到发生的异常
         */
        public function errorAction($exception)
        {
            $constArr = array(
                YAFERRNOTFOUNDMODULE,
                YAFERRNOTFOUNDCONTROLLER,
                YAFERRDISPATCH_FAILED,
                YAFERRNOTFOUNDACTION,
                YAFERRNOTFOUNDVIEW
            );
            $err = $exception-&gt;getCode();
            if (in_array($err, $constArr)) {
                $code = 404;
                $message = &apos;请求的页面不存在&apos;;
            } else {
                $code = 500;
                $message = &apos;系统出错&apos;;
            }
            if (ENV == &apos;DEV&apos;) {
                $message = $exception-&gt;getMessage();
            }
            //记录日志
            //ajax输出或显示错误模板
            $this-&gt;getView()-&gt;assign(&apos;message&apos;, $message);
        }
    }
configure_struct
</code></pre><p><strong>2、通过YafDispatcher的setErrorHandler来捕获错误与异常</strong> 在启动文件中定义一个appErrorHandler的函数，并在_initRoute()中添加相应的捕获代码</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/04/17/e4-bd-bf-e7-94-a8-xdebug-e8-b0-83-e8-af-95php-e7-9a-84-e6-8a-80-e5-b7-a7/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/17/e4-bd-bf-e7-94-a8-xdebug-e8-b0-83-e8-af-95php-e7-9a-84-e6-8a-80-e5-b7-a7/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">使用 xdebug调试PHP的技巧</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 20:40:28" itemprop="dateCreated datePublished" datetime="2017-04-17T20:40:28+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:05:36" itemprop="dateModified" datetime="2018-12-12T17:05:36+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>作者：许胜斌 链接：<a href="https://www.zhihu.com/question/20348619/answer/101893104" target="_blank" rel="noopener">https://www.zhihu.com/question/20348619/answer/101893104</a> 来源：知乎 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p>我目前遇到的最让我称赞的debug方式是：<strong>xdebug</strong>的</p>
<pre><code>xdebug_start_trace();
/* 业务代码     */
xdebug_stop_trace();
</code></pre><p>他解决了我长久以来一个代码调试问题：比如有以下几个场景： 1、一个有几百行的函数，里面有很多return，现在函数异常返回了，但是我不知道是从哪一行返回的，这时候呢，我一般的做法都是每一行echo();die();太费事了。 2、接触一个新的框架，代码执行出现异常，怎么办呢，肯定也是一行一行的echo();die(); 3、想学习一个新框架，想知道代码的执行轨迹：执行了哪些类、调用了哪些类的方法，等等。 现在呢，xdebug的代码跟踪，能帮我们轻松解决上面的问题。 <strong>xdebug的安装</strong> （网上我看到了很多的都是在说xdebug、phpstorm、chrome咋配合起来远程调试，搞得大家好像觉得xdebug用起来那么费事，那么高级，其实没必要）： 1、安装php xdebug扩展（不再细说） 2、配置：这里只讲代码跟踪相关的配置：</p>
<pre><code>cat /etc/php.d/xdebug.ini
extension=/usr/lib64/php/modules/xdebug.so 
;代码跟踪日志文件位置,注意要先新建这个traces目录，并设置777
xdebug.trace_output_dir = /tmp/traces
;代码跟踪日志文件格式 
xdebug.trace_output_name = trace.%c.%p
;trace中显示函数的参数值，这个很有用，待会细说
xdebug.collect_params = 4
xdebug.collect_includes = On
xdebug.collect_return = On
xdebug.show_mem_delta = On
</code></pre><p>  安装好之后，代码执行明细(trace)，就存放在/tmp/traces目录下了:   <img src="https://tech.msla.top/wp-content/uploads/2018/04/d2006b7fc37cc5a97e300655c797e90b_b.png" alt=""> 我截取一段trace日志，大家看下，就能感知到这个用法的方便了： 1、显示了参数的值：就这一点，我想就会节省我们phper很多的调试时间（默认不显示参数值，只显示调用的函数。需要添加xdebug.collect_params这个配置） <img src="https://tech.msla.top/wp-content/uploads/2018/04/972289d2659f965081cc0ac2e8a8de02_b.png" alt=""> 1、显示了参数的值：就这一点，我想就会节省我们phper很多的调试时间（默认不显示参数值，只显示调用的函数。需要添加xdebug.collect_params这个配置） 2、显示了代码的执行轨迹。类似于c语言的单步调试吧。 就这些了，反正用了xdebug，我是觉得debug的时候节省了大量时间，分享给大家，希望对你们也有帮助。 ps：如果大家都xdebug的安装有困惑，可以参考<a href="https://link.zhihu.com/?target=http%3A//www.ibm.com/developerworks/cn/opensource/os-php-xdebug/index.html" target="_blank" rel="noopener">http://www.ibm.com/developerworks/cn/opensource/os-php-xdebug/index.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/04/17/e5-a6-82-e4-bd-95-e4-bc-98-e9-9b-85-e7-9a-84-e8-be-93-e5-87-baphp-e8-b0-83-e8-af-95-e4-bf-a1-e6-81-af/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/17/e5-a6-82-e4-bd-95-e4-bc-98-e9-9b-85-e7-9a-84-e8-be-93-e5-87-baphp-e8-b0-83-e8-af-95-e4-bf-a1-e6-81-af/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">如何优雅的输出PHP调试信息</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 20:38:52" itemprop="dateCreated datePublished" datetime="2017-04-17T20:38:52+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:08:58" itemprop="dateModified" datetime="2018-12-12T17:08:58+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/大前端！/" itemprop="url" rel="index"><span itemprop="name">大前端！</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/大前端！/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何优雅的输出PHP调试信息"><a href="#如何优雅的输出PHP调试信息" class="headerlink" title="如何优雅的输出PHP调试信息"></a><a href="http://www.cnblogs.com/gidot/p/4307709.html" target="_blank" rel="noopener">如何优雅的输出PHP调试信息</a></h2><p>经常因为出现紧急bug而被老板骂的同事，为了更快的修复而直接利用线上的错误环境现场debug，并直接在页面上echo和dump。结果被老板发现了，又是一通臭骂。那么有没有什么办法更优雅的输出PHP调试信息呢？ 这里提供一个方案：利用浏览器调试模式的Console 1，先定义一个php函数：</p>
<p><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></p>
<p> 1 function console($log=’’)<br> 2 {<br> 3     switch (empty($log)) {<br> 4         case False:<br> 5             $out = json_encode($log);<br> 6             $GLOBALS[‘console’] .= ‘console.log(‘.$out.’);’;<br> 7             break;<br> 8<br> 9         default:<br>10             echo ‘<script type="text/javascript">‘.$GLOBALS[‘console’].’</script>‘;<br>11     }<br>12 }</p>
<p><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></p>
<pre><code>2，在需要调试的地方直接调用它，递交的参数可以是字符串，也可以是数组。 ![](https://tech.msla.top/wp-content/uploads/2018/04/012220393931537.png)   3，在适当的位置调用无参数的console，用来输出调试信息，比如各类php框架入口文件的最底部 ![](https://tech.msla.top/wp-content/uploads/2018/04/012221208472406.png)   4，打开浏览器（比如chrome），载入页面后进入调试模式（比如按F12键），点击Console，你会发现所有数据都在这里等着你查阅。 ![](https://tech.msla.top/wp-content/uploads/2018/04/012221469725658-1.png)   5，其他用途 优秀的PHP开源框架ThinkPHP提供了输出运行状态的功能，你可以通过运行状态来了解某个页面在后台处理了多长时间。但是，很多人都注意到了，它是不准确的。 下面我们试着用刚刚加进来的自定义函数console在浏览器中输出真正的运行时间。 所有工作都在入口文件中完成： ![](https://tech.msla.top/wp-content/uploads/2018/04/012222279878126.png) 在所有代码的最开头，定义变量$s=microtime(true); 在console();的上面再增加console(&apos;exetime:&apos;.round(microtime(true)-$s,4)); 好了，我们来看看真正的运行时间吧： ![](https://tech.msla.top/wp-content/uploads/2018/04/012222584566118.png)   这个课题就这么简单愉快的解决了。 PS：因为这个函数用到了json来输出数组，所以要求编码为UTF-8，如果使用其它编码可能会出现未知问题，需要留意。
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/04/17/mongodb-e4-ba-bf-e7-ba-a7-e6-95-b0-e6-8d-ae-e9-87-8f-e7-9a-84-e6-80-a7-e8-83-bd-e6-b5-8b-e8-af-95/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/17/mongodb-e4-ba-bf-e7-ba-a7-e6-95-b0-e6-8d-ae-e9-87-8f-e7-9a-84-e6-80-a7-e8-83-bd-e6-b5-8b-e8-af-95/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">Mongodb亿级数据量的性能测试</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 13:41:34" itemprop="dateCreated datePublished" datetime="2017-04-17T13:41:34+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:20:50" itemprop="dateModified" datetime="2018-12-12T17:20:50+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>进行了一下Mongodb亿级数据量的性能测试，分别测试如下几个项目：</p>
<p> （所有插入都是单线程进行，所有读取都是多线程进行）</p>
<p>1） 普通插入性能 （插入的数据每条大约在1KB左右） 2） 批量插入性能 （使用的是官方C#客户端的InsertBatch），这个测的是批量插入性能能有多少提高 3） 安全插入功能 （确保插入成功，使用的是SafeMode.True开关），这个测的是安全插入性能会差多少 4） 查询一个索引后的数字列，返回10条记录（也就是10KB）的性能，这个测的是索引查询的性能 5） 查询两个索引后的数字列，返回10条记录（每条记录只返回20字节左右的2个小字段）的性能，这个测的是返回小数据量以及多一个查询条件对性能的影响 6） 查询一个索引后的数字列，按照另一个索引的日期字段排序（索引建立的时候是倒序，排序也是倒序），并且Skip100条记录后返回10条记录的性能，这个测的是Skip和Order对性能的影响 7） 查询100条记录（也就是100KB）的性能（没有排序，没有条件），这个测的是大数据量的查询结果对性能的影响 8） 统计随着测试的进行，总磁盘占用，索引磁盘占用以及数据磁盘占用的数量 并且每一种测试都使用单进程的Mongodb和同一台服务器开三个Mongodb进程作为Sharding（每一个进程大概只能用7GB左右的内存）两种方案 其实对于Sharding，虽然是一台机器放3个进程，但是在查询的时候每一个并行进程查询部分数据，再有运行于另外一个机器的mongos来汇总数据，理论上来说在某些情况下性能会有点提高 基于以上的种种假设，猜测某些情况性能会下降，某些情况性能会提高，那么来看一下最后的测试结果怎么样？ 备注：测试的存储服务器是 E5620  @ 2.40GHz，24GB内存，CentOs操作系统，打压机器是E5504 @ 2.0GHz，4GB内存，Windows Server 2003操作系统，两者千兆网卡直连。 <img src="https://tech.msla.top/wp-content/uploads/2018/04/mongodb_erformance-462x1024.png" alt="" title="mongodb_erformance"> 从这个测试可以看出，对于单进程的方式： 1） Mongodb的非安全插入方式，在一开始插入性能是非常高的，但是在达到了两千万条数据之后性能骤减，这个时候恰巧是服务器24G内存基本占满的时候（随着测试的进行mongodb不断占据内存，一直到操作系统的内存全部占满），也就是说Mongodb的内存映射方式，使得数据全部在内存中的时候速度飞快，当部分数据需要换出到磁盘上之后，性能下降很厉害。（这个性能其实也不算太差，因为我们对三个列的数据做了索引，即使在内存满了之后每秒也能插入2MB的数据，在一开始更是每秒插入25MB数据）。Foursquare其实也是把Mongodb当作带持久化的内存数据库使用的，只是在查不到达到内存瓶颈的时候Sharding没处理好。 2） 对于批量插入功能，其实是一次提交一批数据，但是相比一次一条插入性能并没有提高多少，一来是因为网络带宽已经成为了瓶颈，二来我想写锁也会是一个原因。 3） 对于安全插入功能，相对来说比较稳定，不会波动很大，我想可能是因为安全插入是确保数据直接持久化到磁盘的，而不是插入内存就完事。 4） 对于一列条件的查询，性能一直比较稳定，别小看，每秒能有8000-9000的查询次数，每次返回10KB，相当于每秒查询80MB数据，而且数据库记录是2亿之后还能维持这个水平，性能惊人。 5） 对于二列条件返回小数据的查询，总体上性能会比4）好一点，可能返回的数据量小对性能提高比较大，但是相对来说性能波动也厉害一点，可能多了一个条件就多了一个从磁盘换页的机会。 6） 对于一列数据外加Sort和Skip的查询，在数据量大了之后性能明显就变差了（此时是索引数据量超过内存大小的时候，不知道是否有联系），我猜想是Skip比较消耗性能，不过和4）相比性能也不是差距特别大。 7） 对于返回大数据的查询，一秒瓶颈也有800次左右，也就是80M数据，这就进一步说明了在有索引的情况下，顺序查询和按条件搜索性能是相差无几的，这个时候是IO和网络的瓶颈。 8） 在整个过程中索引占的数据量已经占到了总数据量的相当大比例，在达到1亿4千万数据量的时候，光索引就可以占据整个内存，此时查询性能还是非常高，插入性能也不算太差，mongodb的性能确实很牛。 那么在来看看Sharding模式有什么亮点： 1） 非安全插入和单进程的配置一样，在内存满了之后性能急剧下降。安全插入性能和单进程相比慢不少，但是非常稳定。 2） 对于一个条件和两个条件的查询，性能都比较稳定，但条件查询性能相当于单进程的一半，但是在多条件下有的时候甚至会比单进程高一点。我想这可能是某些时候数据块位于两个Sharding，这样Mongos会并行在两个Sharding查询，然后在把数据进行合并汇总，由于查询返回的数据量小，网络不太可能成为瓶颈了，使得Sharding才有出头的机会。 3） 对于Order和Skip的查询，Sharding方式的差距就出来了，我想主要性能损失可能在Order，因为我们并没有按照排序字段作为Sharding的Key，使用的是_id作为Key，这样排序就比较难进行。 4） 对于返回大数据量的查询，Sharding方式其实和单进程差距不是很大，我想数据的转发可能是一个性能损耗的原因（虽然mongos位于打压机本机，但是数据始终是转手了一次）。 5） 对于磁盘空间的占用，两者其实是差不多的，其中的一些差距可能是因为多个进程都会多分配一点空间，加起来有的时候会比单进程多占用点磁盘（而那些占用比单进程少的地方其实是开始的编码错误，把实际数据大小和磁盘文件占用大小搞错了）。 测试最后的各个Sharding分布情况如下：</p>
<pre><code>{
    &quot;sharded&quot;:true,
    &quot;ns&quot;:&quot;testdb.test&quot;,
    &quot;count&quot;:209766143,
    &quot;size&quot;:214800530672,
    &quot;avgObjSize&quot;:1024.0000011441311,
    &quot;storageSize&quot;:222462757776,
    &quot;nindexes&quot;:4,
    &quot;nchunks&quot;:823,
    &quot;shards&quot;:{
        &quot;shard0000&quot;:{
            &quot;ns&quot;:&quot;testdb.test&quot;,
            &quot;count&quot;:69474248,
            &quot;size&quot;:71141630032,
            &quot;avgObjSize&quot;:1024.0000011515058,
            &quot;storageSize&quot;:74154252592,
            &quot;numExtents&quot;:65,
            &quot;nindexes&quot;:4,
            &quot;lastExtentSize&quot;:2146426864,
            &quot;paddingFactor&quot;:1,
            &quot;flags&quot;:1,
            &quot;totalIndexSize&quot;:11294125824,
            &quot;indexSizes&quot;:{
                &quot;_id_&quot;:2928157632,
                &quot;Number_1&quot;:2832745408,
                &quot;Number1_1&quot;:2833974208,
                &quot;Date_-1&quot;:2699248576
            },
            &quot;ok&quot;:1
        },
        &quot;shard0001&quot;:{
            &quot;ns&quot;:&quot;testdb.test&quot;,
            &quot;count&quot;:70446092,
            &quot;size&quot;:72136798288,
            &quot;avgObjSize&quot;:1024.00000113562,
            &quot;storageSize&quot;:74154252592,
            &quot;numExtents&quot;:65,
            &quot;nindexes&quot;:4,
            &quot;lastExtentSize&quot;:2146426864,
            &quot;paddingFactor&quot;:1,
            &quot;flags&quot;:1,
            &quot;totalIndexSize&quot;:11394068224,
            &quot;indexSizes&quot;:{
                &quot;_id_&quot;:2969355200,
                &quot;Number_1&quot;:2826453952,
                &quot;Number1_1&quot;:2828403648,
                &quot;Date_-1&quot;:2769855424
            },
            &quot;ok&quot;:1
        },
        &quot;shard0002&quot;:{
            &quot;ns&quot;:&quot;testdb.test&quot;,
            &quot;count&quot;:69845803,
            &quot;size&quot;:71522102352,
            &quot;avgObjSize&quot;:1024.00000114538,
            &quot;storageSize&quot;:74154252592,
            &quot;numExtents&quot;:65,
            &quot;nindexes&quot;:4,
            &quot;lastExtentSize&quot;:2146426864,
            &quot;paddingFactor&quot;:1,
            &quot;flags&quot;:1,
            &quot;totalIndexSize&quot;:11300515584,
            &quot;indexSizes&quot;:{
                &quot;_id_&quot;:2930942912,
                &quot;Number_1&quot;:2835243968,
                &quot;Number1_1&quot;:2835907520,
                &quot;Date_-1&quot;:2698421184
            },
            &quot;ok&quot;:1
        }
    },
    &quot;ok&quot;:1
}
</code></pre><p>  虽然在最后由于时间的关系，没有测到10亿级别的数据量，但是通过这些数据已经可以证明Mongodb的性能是多么强劲了。另外一个原因是，在很多时候可能数据只达到千万我们就会对库进行拆分，不会让一个库的索引非常庞大。在测试的过程中还发现几个问题需要值得注意： 1） 在数据量很大的情况下，对服务进行重启，那么服务启动的初始化阶段，虽然可以接受数据的查询和修改，但是此时性能很差，因为mongodb会不断把数据从磁盘换入内存，此时的IO压力非常大。 2） 在数据量很大的情况下，如果服务没有正常关闭，那么Mongodb启动修复数据库的时间非常可观，在1.8中退出的-dur貌似可以解决这个问题，据官方说对读取没影响，写入速度会稍稍降低，有空我也会再进行下测试。 3） 在使用Sharding的时候，Mongodb时不时会对数据拆分搬迁，这个时候性能下降很厉害，虽然从测试图中看不出（因为我每一次测试都会测试比较多的迭代次数），但是我在实际观察中可以发现，在搬迁数据的时候每秒插入性能可能会低到几百条。其实我觉得能手动切分数据库就手动切分或者手动做历史库，不要依赖这种自动化的Sharding，因为一开始数据就放到正确的位置比分隔再搬迁效率不知道高多少。个人认为Mongodb单数据库存储不超过1亿的数据比较合适，再大还是手动分库吧。 4） 对于数据的插入，如果使用多线程并不会带来性能的提高，反而还会下降一点性能（并且可以在http接口上看到，有大量的线程处于等待）。 5） 在整个测试过程中，批量插入的时候遇到过几次连接被远程计算机关闭的错误，怀疑是有的时候Mongodb不稳定关闭了连接，或是官方的C#客户端有BUG，但是也仅仅是在数据量特别大的时候遇到几次。</p>
<hr>
<p>最新补充：在之后我又进行了几天测试，把测试数据量进一步加大到5亿，总磁盘占用超过500G，发现和2亿数据量相比，所有性能都差不多，只是测试6和测试7在超过2亿级别数据之后，每400万记录作为一个循环，上下波动30%的性能，非常有规律。 文章来源： <a href="http://www.taocms.org/435.html" target="_blank" rel="noopener">http://www.taocms.org/435.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/04/12/php-tips/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/12/php-tips/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">PHP Tips</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-12 09:37:05" itemprop="dateCreated datePublished" datetime="2017-04-12T09:37:05+08:00">2017-04-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:27:29" itemprop="dateModified" datetime="2018-12-12T17:27:29+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="php中实现后台执行的方法："><a href="#php中实现后台执行的方法：" class="headerlink" title="php中实现后台执行的方法："></a>php中实现后台执行的方法：</h4><pre><code>ignore_user_abort(true); // 后台运行
set_time_limit(0); // 取消脚本运行时间的超时上限
</code></pre><hr>
<h4 id="PHP-连接-RedisServer-时提示-Message-Redis-connect-connect-failed-Permission-denied"><a href="#PHP-连接-RedisServer-时提示-Message-Redis-connect-connect-failed-Permission-denied" class="headerlink" title="PHP 连接 RedisServer 时提示 Message: Redis::connect(): connect() failed: Permission denied"></a>PHP 连接 RedisServer 时提示 <code>Message: Redis::connect(): connect() failed: Permission denied</code></h4><p>第一次出现是连接远程的 Redis 服务器。之后尝试在本地也安装了一个 redis-server，然后手动启动，并连接——错误依旧 <strong>解决方法：</strong> 首先保证当前服务器已经安装了与当前执行的 PHP 版本对应的 Redis 扩展 然后到命令行执行：</p>
<pre><code>/usr/sbin/setsebool httpd_can_network_connect=1
</code></pre><p>参考来源： <a href="http://stackoverflow.com/questions/8765848/troubleshooting-permission-denied-when-attempting-to-connect-to-redis-from-php" target="_blank" rel="noopener">http://stackoverflow.com/questions/8765848/troubleshooting-permission-denied-when-attempting-to-connect-to-redis-from-php</a></p>
<hr>
<h4 id="PHP-生成随机不可逆字符"><a href="#PHP-生成随机不可逆字符" class="headerlink" title="PHP 生成随机不可逆字符"></a>PHP 生成随机不可逆字符</h4><p>比如用作抵御csrf攻击的token</p>
<pre><code>// 命令行执行即可看到结果
php -r &quot;echo sha1(uniqid(rand(), true));&quot;
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/03/31/php-socket-error-too-many-open-files/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/31/php-socket-error-too-many-open-files/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">PHP 运行socket 时报错 too many open files的解决</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-31 12:14:17" itemprop="dateCreated datePublished" datetime="2017-03-31T12:14:17+08:00">2017-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:58:23" itemprop="dateModified" datetime="2018-12-12T17:58:23+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="PHP-运行socket-时报错-too-many-open-files的解决"><a href="#PHP-运行socket-时报错-too-many-open-files的解决" class="headerlink" title="PHP 运行socket 时报错 too many open files的解决"></a>PHP 运行socket 时报错 too many open files的解决</h2><p>我用socket保存数据流为本地文件，然后向数据库追加一条记录，并返回给客户端 跑了一段时间之后，socket就挂掉了，并提示 too many open files 之前一直以为是 file_put_contents 函数或者socket未合理关闭导致的，结果查了好久也没找到原因，有不少网友说可以加大 ulimit 的句柄数（linux 下输入： ulimit -n 就可以看到当前系统的默认允许句柄大小，默认1024），但是个人觉得这个治标不治本。后来也尝试了，不解决问题，因为我传输的文件有数千万张。。。 后来发现，有可能是mysql 的问题，解决顺序如下： 使用</p>
<pre><code>lsof -n |awk &apos;{print $2}&apos;|sort|uniq -c |sort -nr|more
</code></pre><p>命令可以查看系统中不同程序占用的句柄数，<strong>lsof</strong> 可能系统中默认没有安装，需要手动 install 一下 然后可以看到的结果类似下面这样： <img src="https://tech.msla.top/wp-content/uploads/2018/04/20170331_001_ebe2.png" alt=""> 第一列表示的是打开的句柄数，第二列是对应的进程ID 之后使用</p>
<pre><code>ps -ef | grep [进程ID]
</code></pre><p>就可以看到哪个程序在大量占用句柄</p>
<p> 然后，我发现我的是 mysql …弱智错误 —— PDO没有即使关闭。。<br>因为平时写的程序都是非持续性运行的，PDO在PHP脚本执行完之后自动关闭， </p>
<p>但是这个 <code>listen server</code> 是不断打开、写入的，需要手动关闭<br><a href="http://php.net/manual/zh/pdo.connections.php" target="_blank" rel="noopener">官方文档</a>说，<br><code>$pdo=null</code><br> 就可以了。。  </p>
<hr>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/03/31/php-e6-a3-80-e6-b5-8bsocket-e6-9c-8d-e5-8a-a1-e7-ab-af-e8-bf-90-e8-a1-8c-e7-8a-b6-e6-80-81/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/31/php-e6-a3-80-e6-b5-8bsocket-e6-9c-8d-e5-8a-a1-e7-ab-af-e8-bf-90-e8-a1-8c-e7-8a-b6-e6-80-81/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">PHP 检测socket服务端运行状态</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-31 10:58:17" itemprop="dateCreated datePublished" datetime="2017-03-31T10:58:17+08:00">2017-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:22:01" itemprop="dateModified" datetime="2018-12-12T17:22:01+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>做了一个通过socket传输文件用的程序，分别部署在不同的机器上 但是经常会出现 socket-server 断掉的情况，所以 Google 了一下，有没有什么办法可以通过 PHP 检测socket服务端运行状态。</p>
<hr>
<p>可以像下面这么写：  </p>
<pre><code>/**
 * 检测socket端口是否开放(0超时，1正常，2关闭)
 * @param $ip
 * @param $port
 * @return string
 */
public static function checkPort($ip,$port) {
    $sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
    socket_set_nonblock($sock);
    socket_connect($sock,$ip, $port);
    socket_set_block($sock);
    $s_state = @socket_select($r = array($sock), $w = array($sock), $f = array($sock), 3);
    socket_close($sock);

    return $s_state;
}
</code></pre><p>这样就可以了 title： PHP 检测socket服务端运行状态 from ： <a href="https://my.oschina.net/u/2663124/blog/740174" target="_blank" rel="noopener">https://my.oschina.net/u/2663124/blog/740174</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/03/24/e5-9c-a8centos-e4-b8-8a-e4-bd-bf-e7-94-a8yum-e5-ae-89-e8-a3-85redis-e5-8f-8aphp-e6-89-a9-e5-b1-95php-redis/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/24/e5-9c-a8centos-e4-b8-8a-e4-bd-bf-e7-94-a8yum-e5-ae-89-e8-a3-85redis-e5-8f-8aphp-e6-89-a9-e5-b1-95php-redis/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">在centos上使用yum安装redis及php扩展php-redis</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-24 17:50:35" itemprop="dateCreated datePublished" datetime="2017-03-24T17:50:35+08:00">2017-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:08:58" itemprop="dateModified" datetime="2018-12-12T17:08:58+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/操作系统/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-下载"><a href="#1-下载" class="headerlink" title="1. 下载"></a>1. 下载</h2><p>wget <a href="http://mirrors.ustc.edu.cn/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm</a> rpm -ivh epel-release-6-8.noarch.rpm yum install redis php-redis 在CentOS下有时候用rpm安装软件会提示： warning: <em>.rpm: Header V3 RSA/SHA256 Signature, keykey ID c105b9de: NOKEY 解决的方法就是在rpm 语句后面加上 –force –nodeps 即原本为 rpm -ivh </em>.rpm 现在改成 rpm -ivh *.rpm –force –nodeps就可以了。nodeps的意思是忽视依赖关系。因为各个软件之间会有多多少少的联系。有了这两个设置选项就忽略了这些依赖关系，强制安装或者卸载</p>
<h2 id="2-配置防火墙，让外网可以访问redis的6379端口"><a href="#2-配置防火墙，让外网可以访问redis的6379端口" class="headerlink" title="2.配置防火墙，让外网可以访问redis的6379端口"></a>2.配置防火墙，让外网可以访问redis的6379端口</h2><p>vim /etc/sysconfig/iptables 添加 -A INPUT -p tcp -m tcp –dport 6379 -j ACCEPT 重启服务：/etc/init.d/iptables restart(或者service iptables restart) 3.外网访问的话，就打开redis的配置文件，在bind 127.0.0.1前面加上#号 执行vi /etc/redis.conf进行修改,然后重启redis服务 service redis restart(或者/etc/init.d/redis restart)</p>
<h2 id="3-为php配置文件引入redis-so。"><a href="#3-为php配置文件引入redis-so。" class="headerlink" title="3.为php配置文件引入redis.so。"></a>3.为php配置文件引入redis.so。</h2><p>1.cd /usr/lib64/php/modules/ 这个目录下有个redis.so 2.echo ‘extension=redis.so’ &gt; /etc/php.d/redis.ini 然后vi /etc/php.d/redis.ini，去掉里面的单引号</p>
<h2 id="4-重启apache"><a href="#4-重启apache" class="headerlink" title="4.重启apache"></a>4.重启apache</h2><p>service httpd restart(或者/etc/init.d/httpd restart)</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/03/24/freebsd-e4-bd-bf-e7-94-a8-e4-bb-a3-e7-90-86-e4-b8-8a-e7-bd-91-e7-9a-84-e6-96-b9-e6-b3-95/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/24/freebsd-e4-bd-bf-e7-94-a8-e4-bb-a3-e7-90-86-e4-b8-8a-e7-bd-91-e7-9a-84-e6-96-b9-e6-b3-95/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">FREEBSD 使用代理上网的方法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-24 10:28:56" itemprop="dateCreated datePublished" datetime="2017-03-24T10:28:56+08:00">2017-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:19:14" itemprop="dateModified" datetime="2018-12-12T17:19:14+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/操作系统/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>FREEBSD 使用代理上网的方法 FreeBSD 取消了第三方源，所以所有软件都要从主服务器下载，导致国内下载速度非常慢，通常只有 30-40k 左右。 如果有国外的代理，可以用来加速下载和更新软件 —– 为便于今后翻阅，实例预设公司代理服务器地址 192.168.10.100，对应服务端口是： http ====== 8080 ftp ======= 2121 socket ==== 1080 需要用户名和密码验证：用户名 user ，密码 123 <strong>1、fetch 的配置： </strong> fetch用于下载文件，无论是pkg_add -r 方式安装软件包，以及使用ports下载源程序包编译运行，默认都需要使用fetch 配置方法： ee ~/.cshrc setenv HTTP_PROXY <a href="http://user:123@192.168.10.100:8080" target="_blank" rel="noopener">http://user:123@192.168.10.100:8080</a> 若无用户验证 setenv HTTP_PROXY <a href="http://192.168.10.100:8080" target="_blank" rel="noopener">http://192.168.10.100:8080</a> 说明：HTTP_PROXY 是 fetch 程序所支持的环境变量，设置正确后，即可进行文件下载。 ————————————– <strong>上面的方式已通过验证，验证OS： FreeBSD 11.0-RELEASE-p1</strong> <strong>未使用密码、socket</strong> <strong>/etc/make.conf 在我的系统中不存在该文件</strong> 在/etc/make.conf中设置： FETCH_ENV =”HTTP_PROXY=IP[:端口]“ 如果需要，在FETCH_ENV值后面加入空格， HTTP_PROXY_AUTH=basic:*:user:password <strong>2、使用 csup 更新 ports 和源代码 </strong> csup是FreeBSD基本系统所提供的更新ports和src的工具，因为它使用的是cvs协议，所以不能使用HTTP_PROXY的配置，一个解决的办法是使用socket，相关配置如下： 首先要安装 socks5 这个ports，方法是： cd /usr/ports/net/socks5 make install clean rehash 这个软件提供了一个代理服务器实现，但在这里使用的是它的客户端程序 runsocks 网络配置也是通过socks所支持的环境变量来实现，具体配置是： setenv SOCKS5_SERVER 192.168,10.100:1080 setenv SOCKS5_USER user setenv SOCKS5_PASSWD 123 runsocks使用这三个环境变量确定主机、端口、用户名和密码，至于使用sock4还是socket 5，虽说也提供了相关环境变量，但实际runsocks可进行自动检测。 更新ports和src的命令行： runsocks csup -L 2 ports-supfiles runsocks csup -L 2 your-src-supfiles <strong>3、通过代理服务器使用 subvirsion </strong> 提示：若访问FreeBSD的svn库，推荐使用 /usr/ports/devel/subversion-freebsd 这个ports，这个ports提供了一个patch，用于访问FreeBSD的svn代码库 svn使用配置文件的方式设置代理服务器访问网络。配置文件具体路径为： ~/.subversion/   以上，<strong>FREEBSD 使用代理上网的方法</strong></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.cobsun.com/2017/03/21/e5-8d-8e-e4-b8-ba-e6-89-8b-e6-9c-ba-e8-a7-a3-e9-94-81-e6-96-b9-e5-bc-8f/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/03/21/e5-8d-8e-e4-b8-ba-e6-89-8b-e6-9c-ba-e8-a7-a3-e9-94-81-e6-96-b9-e5-bc-8f/" class="post-title-link" itemprop="https://www.cobsun.com/page/12/index.html">华为手机解锁方式</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-21 11:52:54" itemprop="dateCreated datePublished" datetime="2017-03-21T11:52:54+08:00">2017-03-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:08:58" itemprop="dateModified" datetime="2018-12-12T17:08:58+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>首先要获取解锁码：<a href="http://emui.huawei.com/plugin/hwdownload/download" target="_blank" rel="noopener">http://emui.huawei.com/plugin/hwdownload/download</a></strong> <strong>搜索框右下角，“刷机解锁”</strong>   第一步：准备工作 1. 在PC上正确安装手机驱动程序，驱动请在华为终端官网上下载。 2. 下载Google提供的ADB工具包并在PC上安装，如安装到D:adb_tools-2.0目录，确认目录中带有fastboot.exe文件。 第二步：解锁操作 1. 手机进入fastboot模式： 先将手机关机（注意需要首先在设置菜单中，关闭“快速启动”功能，或者关机后拔下电池，超过2秒后再重新插入），然后同时按下音量下键以及开机键（平板请同时按下音量上键及开机键），并保持10秒钟以上时间，就可以进入fastboot模式。 如果上述操作无法进入fastboot模式，请尝试使用如下步骤： 将手机关机（注意需要首先在设置菜单中，关闭“快速启动”功能，或者关机后拔下电池，超过2秒后再重新插入），然后插入USB线，紧接着同时按下音量下键和开机键，保持10秒钟以上时间，就可以进入fastboot模式。   2. 连接手机和PC机： 使用USB线连接手机和PC机，打开PC机的命令行窗口，进入ADB安装目录，确认手机与PC连接正常，确认方法为在命令行窗口输入fastboot devices，可以看到正常连接的信息，如：9e42530e fastboot。</p>
<p><img src="https://emui.huawei.com/publish/static/plugin/unlock/template/image/step2.png?v4.7" alt=""></p>
<p>  3. 执行解锁命令： 在PC机命令行窗口中输入fastboot oem unlock <strong><strong><strong><em>**</em></strong></strong></strong>，*号为16位解锁密码，例如：fastboot oem unlock 1234567812345678。</p>
<p><img src="https://emui.huawei.com/publish/static/plugin/unlock/template/image/step3.png?v4.7" alt=""></p>
<p>  4. 等待手机解锁完成： 输入解锁密码后，手机将自动重启，如果输入密码正确，手机将进入恢复出厂设置模式。恢复出厂设置完成后，手机自动重启，进入待机界面，完成整个解锁操作。如果用户输入密码信息不正确，手机将提示出错信息，并进入待机界面。   5. 查询手机解锁是否成功： 重复1、2步，然后在PC的命令行窗口中输入fastboot oem get-bootinfo，将显示当前手机bootloader的状态信息，例如“Bootloader Lock State: LOCKED”，表示bootloader仍处于锁定状态，请重新进行解锁操作或者确认密码是否正确后再进行；如果显示“Bootloader Lock State: UNLOCKED”，表示手机已经解锁，可以进行刷机操作。</p>
<p><img src="https://emui.huawei.com/publish/static/plugin/unlock/template/image/step5.png?v4.7" alt=""></p>
<p>  注意：解锁成功后，如果希望将手机重新加锁请按以下步骤操作：首先，通过SD卡升级方式，将手机版本重新恢复为华为官方发布版本；然后，进入fastboot模式，在PC的命令行下输入命令fastboot oem relock <strong><strong><strong><em>**</em></strong></strong></strong>，*号为16位解锁密码。手机将自动重启，bootloader转换为“RELOCKED”状态。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description">$$ Welcome $$</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">183</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">262</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>


  

</body>
</html>
