<!DOCTYPE html>













<html class="theme-next gemini" lang="zh-cn">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="$$ Welcome $$">
<meta property="og:type" content="website">
<meta property="og:title" content="Technician">
<meta property="og:url" content="https://hero.triple.net.cn/page/11/index.html">
<meta property="og:site_name" content="Technician">
<meta property="og:description" content="$$ Welcome $$">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Technician">
<meta name="twitter:description" content="$$ Welcome $$">






  <link rel="canonical" href="https://hero.triple.net.cn/page/11/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Technician</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Technician</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Yet another note</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>Sitemap</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/05/05/sqlite-e6-af-94bdb-e6-9b-b4-e5-bf-ab-ef-bc-9f/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/05/05/sqlite-e6-af-94bdb-e6-9b-b4-e5-bf-ab-ef-bc-9f/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">Sqlite比BDB更快？</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-05-05 11:34:46" itemprop="dateCreated datePublished" datetime="2017-05-05T11:34:46+08:00">2017-05-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:27:29" itemprop="dateModified" datetime="2018-12-12T17:27:29+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简单的-Sqlite-DB-和-Berkeley-DB-性能对比"><a href="#简单的-Sqlite-DB-和-Berkeley-DB-性能对比" class="headerlink" title="简单的 Sqlite DB 和 Berkeley DB 性能对比"></a>简单的 Sqlite DB 和 Berkeley DB 性能对比</h1><p>最近在找一些 简单、快速存取、方便移植的数据库 首先发现了BerkeleyDB，测试下来 ，觉得速度还可以，尝试过插入1亿条记录，在我本地虚拟机里大概耗时700秒左右（6.1G 内存, i5 4590 CPU, SSD 40G） 正准备生产用一下，突然发现了一个文章，原文在这里 <a href="http://blog.csdn.net/mynicedream/article/details/2252398" target="_blank" rel="noopener">http://blog.csdn.net/mynicedream/article/details/2252398</a> 。 文中提到 Sqlite 速度高于 BDB 不少，有点疑惑， 遂自己测试了一下，就拿简单的Insert，也没做任何优化，没有用大批量Insert 的方法（这也许更接近实际应用环境） 测试环境：</p>
<p>内存: 8G<br>CPU: Intel® Core i3-4130 CPU @ 3.40GHz × 4<br>磁盘： 500GB 普通台式机机械盘<br>系统： Ubuntu 16.04.2</p>
<h3 id="先来BerkeleyDB的插入性能测试"><a href="#先来BerkeleyDB的插入性能测试" class="headerlink" title="先来BerkeleyDB的插入性能测试"></a>先来BerkeleyDB的插入性能测试</h3><p><strong>代码：</strong></p>
<pre><code>#coding:utf8

import time
import bsddb3
import hashlib

test_num = 100

def md5(s):
    return hashlib.md5(s).hexdigest()

def insert_md5(db):
    t0 = time.time()
    for i in xrange(1,test_num+1):
        if i%10000 == 0:
            print i

        if not db.has_key(i):
            str_md5 = md5(str(i))
            db[i] = str_md5

    print time.time() - t0

def main():
    t0 = time.time()
    db = bsddb3.rnopen(&apos;md5_digest.db&apos;, &apos;c&apos;)
    #insert_md5(db)
    print db.get(23152346)
    print str(time.time()-t0)

if __name__ == &apos;__main__&apos;:
    main()
</code></pre><p>—- <strong>测试结果</strong> 1千万条数据大概12秒左右</p>
<pre><code>1. 10000000 120.37905097 
2. 10000000 126.873742104
3. 10000000 102.667818069
4. 10000000 106.770079136
</code></pre><p>---</p>
<h3 id="Sqlite-的测试"><a href="#Sqlite-的测试" class="headerlink" title="Sqlite 的测试"></a>Sqlite 的测试</h3><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a><strong>源码</strong></h3><p>事先准备好空的 sqlitedb 数据库文件，包含一张表 test_1，有 md5 varchar(36) 和 numb integer 两个字段</p>
<pre><code>#coding=utf8

import time
import sqlite3
import hashlib

test_num = 10000000

def md5(s):
    return hashlib.md5(s).hexdigest()

def insert_md5():
    t0 = time.time()
    conn = sqlite3.connect(&apos;test_sqlite.db&apos;)
    cursor = conn.cursor()
    for i in xrange(1,test_num+1):
        if i%10000 == 0:
            t_1 = time.time()
            print i
            print &quot;----&gt; Being Last: &quot; + str(t_1-t0) + &quot; avg: &quot; + str((time.time()-t0)/float(i)) + &quot; seconds/10,000&quot;

        cursor.execute(&apos;insert into test_1 (md5, numb) values (&apos;&apos;+md5(str(i))+&apos;&apos;, &apos;&apos;+str(i)+&apos;&apos;)&apos;)

    print time.time() - t0
    cursor.close()
    conn.commit()
    conn.close()

def main():
    t0 = time.time()
    insert_md5()
    print str(time.time()-t0)

if __name__ == &apos;__main__&apos;:
    main()
</code></pre><p><strong>测试结果</strong></p>
<pre><code>1. 10000000 275.150636196
2. 10000000 250.863370895
3. 10000000 256.767675877
</code></pre><p>---</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>也许Sqlite 方面有什么优化吧，我不知道，但是这结果相差很明显，我生产环境的情况基本和这个一样，不愿意去折腾了 我还是相信我自己最初判断 <em> BDB之所以比Sqlite商用份额多， </em> 博客园有网友测试结果BDB比Redis还快（<a href="http://www.cnblogs.com/me115/p/3395396.html），" target="_blank" rel="noopener">http://www.cnblogs.com/me115/p/3395396.html），</a> * cdn缓存用BDB而不是Sqlite 等等，都能从侧面说明问题 ps: 还从Google上发现了百度文库里面也有人传了个关于BDB和Sqlite的性能对比，结果就是把文章头和尾重新写了一堆废话，然后把上面CSDN上面的那个测试结果贴在中间 。。。。 无语了，鄙视这样的人。。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/05/04/nginx-e4-b8-8bcodeiginter-e9-85-8d-e7-bd-ae/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/05/04/nginx-e4-b8-8bcodeiginter-e9-85-8d-e7-bd-ae/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">Nginx下CodeIginter配置</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-05-04 11:26:21" itemprop="dateCreated datePublished" datetime="2017-05-04T11:26:21+08:00">2017-05-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:21:19" itemprop="dateModified" datetime="2018-12-12T17:21:19+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Example, when none-configured: <code>http://127.0.0.1/ci/index.php/hello/index</code></p>
<h3 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1:"></a>Method 1:</h3><p>当nginx找不到文件和目录时，不返回404，而是重定向到index.php入口文件</p>
<pre><code>location /ci/ { 
        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
        try_files $uri $uri/ /ci/index.php;
}
</code></pre><h3 id="Method-2："><a href="#Method-2：" class="headerlink" title="Method 2："></a>Method 2：</h3><pre><code>location /ci/ {            
      if (!-e $request_filename) {
            rewrite  ^/(.*)$  /ci/index.php?$1 last;                          
            break;             
      }                      
}
</code></pre><p>  个人配置：</p>
<h3 id="application-—"><a href="#application-—" class="headerlink" title="--- application —"></a>--- application —</h3><pre><code>// config.php
base_url :  http://172.16.85.221:1981/
index_url:  /index.php?
</code></pre><h3 id="useage"><a href="#useage" class="headerlink" title="useage:"></a>useage:</h3><p><strong>1.1 on view, normal</strong></p>
<pre><code>&lt;?php echo anchor(&apos;manager/password/reset&apos;, &apos;Password reset&apos;);?&gt;
&lt;a href=&quot;&lt;?php%20echo%20site_url(&apos;manager/AppTranslate&apos;)%20?&gt;&quot;&gt;Translate&lt;/a&gt;
</code></pre><p><strong>1.2 on view, ajax request(javascript block)</strong></p>
<pre><code>$.ajax({
    &apos;method&apos;: &apos;POST&apos;,
    &apos;dataType&apos;: &apos;json&apos;,
    &apos;data&apos;: {&apos;uid&apos;: uid, &apos;uname&apos;: uname},
    &apos;url&apos;: &apos;&lt;?php echo site_url(&apos;manager/UserManager/delete&apos;); ?&gt;&apos;,
    &apos;success&apos;: function (data) {
        if (data &amp;&amp; data.data.status == true) {
            alert(&apos;Selected user&apos;s state already delete&apos;);
        } else {
            alert(&apos;Delete user failed.&apos;);
        }
    },
    &apos;error&apos;: function (err_data){
        alert(&apos;delete failed.&apos;);
        console.log(err_data);
    }
});
</code></pre><p><strong>2.1 on controller</strong></p>
<pre><code>$this-&gt;load-&gt;library(&apos;pagination&apos;);
$config[&apos;base_url&apos;] = &apos;index.php?/manager/ListUser/index&apos;;
$config[&apos;total_rows&apos;] = $this-&gt;users-&gt;get_user_count(&apos;&apos;);
$this-&gt;pagination-&gt;initialize($config);
$page_size = $this-&gt;config-&gt;item(&apos;per_page&apos;);
$pagination_link = $this-&gt;pagination-&gt;create_links();
</code></pre><h3 id="nginx-—"><a href="#nginx-—" class="headerlink" title="--- nginx —"></a>--- nginx —</h3><pre><code>38 server {
39 &gt;---listen 1081 default_server;
40 &gt;---listen [::]:1081 default_server;
41 &gt;---root /home/wwwroot/Maret_API_MGR;
42 
43 &gt;---index index.php index.html;
44 
45 &gt;---server_name _;
46 
47 &gt;---location / {
48         try_files $uri $uri/ /index.php;
49         if (!-e $request_filename) {                                                                                                                                                      
50             rewrite ^/(index.php?/)(.*)([/])$
51             http://172.16.85.221:1981/$2/index.php break;
52         }
53 &gt;---}
54 
55 &gt;---location ~ .php$ {
56 &gt;---&gt;---include snippets/fastcgi-php.conf;
57 &gt;---&gt;---fastcgi_pass unix:/run/php/php7.0-fpm.sock;
58 &gt;---}
59 }
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/28/gets-all-files-in-the-directory-with-php/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/28/gets-all-files-in-the-directory-with-php/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">PHP 获取目录下的所有文件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-28 16:00:25" itemprop="dateCreated datePublished" datetime="2017-04-28T16:00:25+08:00">2017-04-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-18 16:33:27" itemprop="dateModified" datetime="2018-12-18T16:33:27+08:00">2018-12-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="PHP-获取目录下的所有文件"><a href="#PHP-获取目录下的所有文件" class="headerlink" title="PHP 获取目录下的所有文件"></a>PHP 获取目录下的所有文件</h1><p>转载了一篇通过PHP获取指定目录下所有文件/子文件并打印出来的方法，实测可用</p>
<p>运行示例：<br>执行文件在 home 目录下，指定要获取的是 home 下的 Picture 目录（包含子目录）</p>
<p><img src="https://tech.msla.top/wp-content/uploads/2018/04/5902f77ec5d7a.png" alt="20170428_001_e1a5.png" title="20170428_001_e1a5.png"></p>
<h3 id="1-获取目录下文件，不包括子目录"><a href="#1-获取目录下文件，不包括子目录" class="headerlink" title="1. 获取目录下文件，不包括子目录"></a>1. 获取目录下文件，不包括子目录</h3><p><code></code><br>    //获取某目录下所有文件、目录名（不包括子目录下文件、目录名）<br>        $handler = opendir($dir);<br>        while (($filename = readdir($handler)) !== false) {//务必使用!==，防止目录下出现类似文件名“0”等情况<br>            if ($filename != “.” &amp;&amp; $filename != “..”) {<br>                    $files[] = $filename ;<br>               }<br>           }<br>        }<br>        closedir($handler);  </p>
<pre><code>//打印所有文件名  
foreach ($filens as $value) {  
    echo $value.&quot;&quot;;  
}
</code></pre><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">### 2\. 获取目录下所有文件，包括子目录</span><br><span class="line"></span><br><span class="line">注意，最好使用绝对路径，相对路径不能用 &quot;../xxxx/bbb&quot; 或者 &quot;~/aaa/bbb/ccc&quot; 这样的</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">    function get_allfiles($path,&amp;$files) &#123;</span><br><span class="line">        if(is_dir($path))&#123;</span><br><span class="line">            $dp = dir($path);</span><br><span class="line">            while ($file = $dp -&gt;read())&#123;</span><br><span class="line">                if($file !=&quot;.&quot; &amp;&amp; $file !=&quot;..&quot;)&#123;</span><br><span class="line">                    get_allfiles($path.&quot;/&quot;.$file, $files);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            $dp -&gt;close();</span><br><span class="line">        &#125;</span><br><span class="line">        if(is_file($path))&#123;</span><br><span class="line">            $files[] =  $path;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function get_filenamesbydir($dir)&#123;</span><br><span class="line">        $files =  array();</span><br><span class="line">        get_allfiles($dir,$files);</span><br><span class="line">        return $files;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 路径末尾可以不用放斜线</span><br><span class="line">    $filenames = get_filenamesbydir(&quot;Picture&quot;);</span><br><span class="line">    //打印所有文件名，包括路径</span><br><span class="line">    foreach ($filenames as $value) &#123;</span><br><span class="line">        echo $value.&quot;&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/27/nginx-e9-85-8d-e7-bd-aelocation-e6-80-bb-e7-bb-93-e5-8f-8arewrite-e8-a7-84-e5-88-99-e5-86-99-e6-b3-95/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/27/nginx-e9-85-8d-e7-bd-aelocation-e6-80-bb-e7-bb-93-e5-8f-8arewrite-e8-a7-84-e5-88-99-e5-86-99-e6-b3-95/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">nginx配置location总结及rewrite规则写法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-27 15:11:24" itemprop="dateCreated datePublished" datetime="2017-04-27T15:11:24+08:00">2017-04-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:21:19" itemprop="dateModified" datetime="2018-12-12T17:21:19+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-location正则写法"><a href="#1-location正则写法" class="headerlink" title="1. location正则写法"></a>1. location正则写法</h1><p>一个示例：</p>
<p>location = / { # 精确匹配 / ，主机名后面不能带任何字符串 [ configuration A ] }location / { # 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求 # 但是正则和最长字符串会优先匹配 [ configuration B ] }location /documents/ { # 匹配任何以 /documents/ 开头的地址，匹配符合以后，还要继续往下搜索 # 只有后面的正则表达式没有匹配到时，这一条才会采用这一条 [ configuration C ] }location ~ /documents/Abc { # 匹配任何以 /documents/Abc 开头的地址，匹配符合以后，还要继续往下搜索 # 只有后面的正则表达式没有匹配到时，这一条才会采用这一条 [ configuration CC ] }location ^~ /images/ { # 匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条。 [ configuration D ] } location ~<em> \.(gif|jpg|jpeg)$ { # 匹配所有以 gif,jpg或jpeg 结尾的请求 # 然而，所有请求 /images/ 下的图片会被 config D 处理，因为 ^~ 到达不了这一条正则 [ configuration E ] } location /images/ { # 字符匹配到 /images/，继续往下，会发现 ^~ 存在 [ configuration F ] } location /images/abc { # 最长字符匹配到 /images/abc，继续往下，会发现 ^~ 存在 # F与G的放置顺序是没有关系的 [ configuration G ] } location ~ /images/abc/ { # 只有去掉 config D 才有效：先最长匹配 config G 开头的地址，继续往下搜索，匹配到这一条正则，采用 [ configuration H ] } location ~</em> /js/.*/\.js</p>
<ul>
<li>已<code>=</code>开头表示精确匹配 如 A 中只匹配根目录结尾的请求，后面不能带任何字符串。</li>
<li><code>^~</code> 开头表示uri以某个常规字符串开头，不是正则匹配</li>
<li>~ 开头表示区分大小写的正则匹配;</li>
<li>~* 开头表示不区分大小写的正则匹配</li>
<li>/ 通用匹配, 如果没有其它匹配,任何请求都会匹配到</li>
</ul>
<p>顺序 no优先级： (location =) &gt; (location 完整路径) &gt; (location ^~ 路径) &gt; (location ~,~* 正则顺序) &gt; (location 部分起始路径) &gt; (/) 上面的匹配结果 按照上面的location写法，以下的匹配示例成立：</p>
<ul>
<li>/ -> config A 精确完全匹配，即使/index.html也匹配不了</li>
<li>/downloads/download.html -&gt; config B 匹配B以后，往下没有任何匹配，采用B</li>
<li>/images/1.gif -&gt; configuration D 匹配到F，往下匹配到D，停止往下</li>
<li>/images/abc/def -&gt; config D 最长匹配到G，往下匹配D，停止往下 你可以看到 任何以/images/开头的都会匹配到D并停止，FG写在这里是没有任何意义的，H是永远轮不到的，这里只是为了说明匹配顺序</li>
<li>/documents/document.html -&gt; config C 匹配到C，往下没有任何匹配，采用C</li>
<li>/documents/1.jpg -&gt; configuration E 匹配到C，往下正则匹配到E</li>
<li>/documents/Abc.jpg -&gt; config CC 最长匹配到C，往下正则顺序匹配到CC，不会往下到E</li>
</ul>
<h2 id="实际使用建议"><a href="#实际使用建议" class="headerlink" title="实际使用建议"></a>实际使用建议</h2><p>所以实际使用中，个人觉得至少有三个匹配规则定义，如下： #直接匹配网站根，通过域名访问网站首页比较频繁，使用这个会加速处理，官网如是说。 #这里是直接转发给后端应用服务器了，也可以是一个静态首页 # 第一个必选规则 location = / { proxy_pass <a href="http://tomcat:8080/index" target="_blank" rel="noopener">http://tomcat:8080/index</a> } # 第二个必选规则是处理静态文件请求，这是nginx作为http服务器的强项 # 有两种配置模式，目录匹配或后缀匹配,任选其一或搭配使用 location ^~ /static/ { root /webroot/static/; } location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ { root /webroot/res/; } #第三个规则就是通用规则，用来转发动态请求到后端应用服务器 #非静态文件请求就默认是动态请求，自己根据实际把握 #毕竟目前的一些框架的流行，带.php,.jsp后缀的情况很少了 location / { proxy_pass <a href="http://tomcat:8080/" target="_blank" rel="noopener">http://tomcat:8080/</a> }</p>
<p><a href="http://tengine.taobao.org/book/chapter_02.html" target="_blank" rel="noopener">http://tengine.taobao.org/book/chapter_02.html</a> <a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html" target="_blank" rel="noopener">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html</a></p>
<h1 id="2-Rewrite规则"><a href="#2-Rewrite规则" class="headerlink" title="2. Rewrite规则"></a>2. Rewrite规则</h1><p>rewrite功能就是，使用nginx提供的全局变量或自己设置的变量，结合正则表达式和标志位实现url重写以及重定向。rewrite只能放在server{},location{},if{}中，并且只能对域名后边的除去传递的参数外的字符串起作用，例如 <code>http://seanlook.com/a/we/index.php?id=1&amp;u=str</code> 只对/a/we/index.php重写。语法<code>rewrite regex replacement [flag];</code> 如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用proxy_pass反向代理。 表明看rewrite和location功能有点像，都能实现跳转，主要区别在于rewrite是在同一域名内更改获取资源的路径，而location是对一类路径做控制访问或反向代理，可以proxy_pass到其他机器。很多情况下rewrite也会写在location里，它们的执行顺序是：</p>
<ol>
<li>执行server块的rewrite指令</li>
<li>执行location匹配</li>
<li>执行选定的location中的rewrite指令</li>
</ol>
<p>如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件；循环超过10次，则返回500 Internal Server Error错误。</p>
<h2 id="2-1-flag标志位"><a href="#2-1-flag标志位" class="headerlink" title="2.1 flag标志位"></a>2.1 flag标志位</h2><ul>
<li><code>last</code> : 相当于Apache的[L]标记，表示完成rewrite</li>
<li><code>break</code> : 停止执行当前虚拟主机的后续rewrite指令集</li>
<li><code>redirect</code> : 返回302临时重定向，地址栏会显示跳转后的地址</li>
<li><code>permanent</code> : 返回301永久重定向，地址栏会显示跳转后的地址</li>
</ul>
<p>因为301和302不能简单的只返回状态码，还必须有重定向的URL，这就是return指令无法返回301,302的原因了。这里 last 和 break 区别有点难以理解：</p>
<ol>
<li>last一般写在server和if中，而break一般使用在location中</li>
<li>last不终止<em>重写后</em>的url匹配，即新的url会再从server走一遍匹配流程，而break终止重写后的匹配</li>
<li>break和last都能组织继续执行后面的rewrite指令</li>
</ol>
<h2 id="2-2-if指令与全局变量"><a href="#2-2-if指令与全局变量" class="headerlink" title="2.2 if指令与全局变量"></a>2.2 if指令与全局变量</h2><p><strong>if判断指令</strong> 语法为<code>if(condition){...}</code>，对给定的条件condition进行判断。如果为真，大括号内的rewrite指令将被执行，if条件(conditon)可以是如下任何内容：</p>
<ul>
<li>当表达式只是一个变量时，如果值为空或任何以0开头的字符串都会当做false</li>
<li>直接比较变量和内容时，使用<code>=</code>或<code>!=</code></li>
<li><code>~</code>正则表达式匹配，<code>~*</code>不区分大小写的匹配，<code>!~</code>区分大小写的不匹配</li>
</ul>
<p><code>-f</code>和<code>!-f</code>用来判断是否存在文件 <code>-d</code>和<code>!-d</code>用来判断是否存在目录 <code>-e</code>和<code>!-e</code>用来判断是否存在文件或目录 <code>-x</code>和<code>!-x</code>用来判断文件是否可执行 例如：</p>
<p>if ($http_user_agent ~ MSIE) { rewrite ^(.<em>)$ /msie/$1 break; } //如果UA包含”MSIE”，rewrite请求到/msid/目录下if ($http_cookie ~</em> “id=([^;]+)(?:;|$)”) { set $id $1; } //如果cookie匹配正则，设置变量$id等于正则引用部分if ($request_method = POST) { return 405; } //如果提交方法为POST，则返回状态405（Method not allowed）。return不能返回301,302if ($slow) { limit_rate 10k; } //限速，$slow可以通过 set 指令设置if (!-f $request_filename){ break; proxy_pass <a href="http://127.0.0.1" target="_blank" rel="noopener">http://127.0.0.1</a>; } //如果请求的文件名不存在，则反向代理到localhost 。这里的break也是停止rewrite检查 if ($args ~ post=140){ rewrite ^ <a href="http://example.com/" target="_blank" rel="noopener">http://example.com/</a> permanent; } //如果query string中包含”post=140”，永久重定向到example.com location ~* \.(gif|jpg|png|swf|flv)$ { valid_referers none blocked <a href="http://www.jefflei.com" target="_blank" rel="noopener">www.jefflei.com</a> <a href="http://www.leizhenfang.com" target="_blank" rel="noopener">www.leizhenfang.com</a>; if ($invalid_referer) { return 404; } //防盗链 }</p>
<p><strong>全局变量</strong> 下面是可以用作if判断的全局变量</p>
<ul>
<li><code>$args</code> ： #这个变量等于请求行中的参数，同<code>$query_string</code></li>
<li><code>$content_length</code> ： 请求头中的Content-length字段。</li>
<li><code>$content_type</code> ： 请求头中的Content-Type字段。</li>
<li><code>$document_root</code> ： 当前请求在root指令中指定的值。</li>
<li><code>$host</code> ： 请求主机头字段，否则为服务器名称。</li>
<li><code>$http_user_agent</code> ： 客户端agent信息</li>
<li><code>$http_cookie</code> ： 客户端cookie信息</li>
<li><code>$limit_rate</code> ： 这个变量可以限制连接速率。</li>
<li><code>$request_method</code> ： 客户端请求的动作，通常为GET或POST。</li>
<li><code>$remote_addr</code> ： 客户端的IP地址。</li>
<li><code>$remote_port</code> ： 客户端的端口。</li>
<li><code>$remote_user</code> ： 已经经过Auth Basic Module验证的用户名。</li>
<li><code>$request_filename</code> ： 当前请求的文件路径，由root或alias指令与URI请求生成。</li>
<li><code>$scheme</code> ： HTTP方法（如http，https）。</li>
<li><code>$server_protocol</code> ： 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</li>
<li><code>$server_addr</code> ： 服务器地址，在完成一次系统调用后可以确定这个值。</li>
<li><code>$server_name</code> ： 服务器名称。</li>
<li><code>$server_port</code> ： 请求到达服务器的端口号。</li>
<li><code>$request_uri</code> ： 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。</li>
<li><code>$uri</code> ： 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。</li>
<li><code>$document_uri</code> ： 与$uri相同。</li>
</ul>
<p>例：<code>http://localhost:88/test1/test2/test.php</code> $host：localhost $server_port：88 $request_uri：<a href="http://localhost:88/test1/test2/test.php" target="_blank" rel="noopener">http://localhost:88/test1/test2/test.php</a> $document_uri：/test1/test2/test.php $document_root：/var/www/html $request_filename：/var/www/html/test1/test2/test.php</p>
<h2 id="2-3-常用正则"><a href="#2-3-常用正则" class="headerlink" title="2.3 常用正则"></a>2.3 常用正则</h2><ul>
<li><code>.</code> ： 匹配除换行符以外的任意字符</li>
<li><code>?</code> ： 重复0次或1次</li>
<li><code>+</code> ： 重复1次或更多次</li>
<li><code>*</code> ： 重复0次或更多次</li>
<li><code>\d</code> ：匹配数字</li>
<li><code>^</code> ： 匹配字符串的开始</li>
<li><code>$</code> ： 匹配字符串的介绍</li>
<li><code>{n}</code> ： 重复n次</li>
<li><code>{n,}</code> ： 重复n次或更多次</li>
<li><code>[c]</code> ： 匹配单个字符c</li>
<li><code>[a-z]</code> ： 匹配a-z小写字母的任意一个</li>
</ul>
<p>小括号<code>()</code>之间匹配的内容，可以在后面通过<code>$1</code>来引用，<code>$2</code>表示的是前面第二个<code>()</code>里的内容。正则里面容易让人困惑的是<code>\</code>转义特殊字符。</p>
<h2 id="2-4-rewrite实例"><a href="#2-4-rewrite实例" class="headerlink" title="2.4 rewrite实例"></a>2.4 rewrite实例</h2><p>_例1_：</p>
<p>http { # 定义image日志格式 log_format imagelog ‘[$time_local] ‘ $image_file ‘ ‘ $image_type ‘ ‘ $body_bytes_sent ‘ ‘ $status; # 开启重写日志 rewrite_log on;server { root /home/www;location / { # 重写规则信息 error_log logs/rewrite.log notice; # 注意这里要用‘’单引号引起来，避免{} rewrite ‘^/images/([a-z]{2})/([a-z0-9]{5})/(.*)\.(png|jpg|gif)$’ /data?file=$3.$4; # 注意不能在上面这条规则后面加上“last”参数，否则下面的set指令不会执行 set $image_file $3; set $image_type $4; }location /data { # 指定针对图片的日志格式，来分析图片类型和大小 access_log logs/images.log mian; root /data/images; # 应用前面定义的变量。判断首先文件在不在，不在再判断目录在不在，如果还不在就跳转到最后一个url里 try_files /$arg_file /image404.html; } location = /image404.html { # 图片不存在返回特定的信息 return 404 “image not found\n”; } }</p>
<p>对形如<code>/images/ef/uh7b3/test.png</code>的请求，重写到<code>/data?file=test.png</code>，于是匹配到<code>location /data</code>，先看<code>/data/images/test.png</code>文件存不存在，如果存在则正常响应，如果不存在则重写tryfiles到新的image404 location，直接返回404状态码。 _例2_：</p>
<p>1</p>
<p>rewrite ^/images/(.*)_(\d+)x(\d+)\.(png|jpg|gif)$ /resizer/$1.$4?width=$2&amp;height=$3? last;</p>
<p>对形如<code>/images/bla_500x400.jpg</code>的文件请求，重写到<code>/resizer/bla.jpg?width=500&amp;height=400</code>地址，并会继续尝试匹配location。 _例3_： 见 <a href="http://seanlook.com/2015/05/28/nginx-ssl" target="_blank" rel="noopener">ssl部分页面加密</a> 。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/21/glusterfs-e8-b0-83-e7-a0-94/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/21/glusterfs-e8-b0-83-e7-a0-94/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">GlusterFS 调研</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-21 18:55:19" itemprop="dateCreated datePublished" datetime="2017-04-21T18:55:19+08:00">2017-04-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:19:14" itemprop="dateModified" datetime="2018-12-12T17:19:14+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>与Hadoop HDFS不同的是：GlusterFS使用了弹性哈希算法来定位文件存储的位置。 由于使用了弹性哈希算法，GlusterFS不需要专门的Meta-Data Server来保存元数据，因此可以避免因为元数据服务器宕机导致的整个集群不可用。也正是因为不需要元数据服务器，所以GlusterFS在多个挂载点同时进行数据读写的时候，其整体性能很突出。</p>
<h4 id="在GlusterFS-3-3版本中增加的新功能包括"><a href="#在GlusterFS-3-3版本中增加的新功能包括" class="headerlink" title="在GlusterFS 3.3版本中增加的新功能包括"></a>在GlusterFS 3.3版本中增加的新功能包括</h4><ol>
<li>统一的文件和对象存储：GlusterFS实现了OpenStack里的对象存储API提供同步读取和写入文件或对象的数据的访问。</li>
<li>HDFS兼容： 使Hadoop的管理员在GlusterFS的非结构化数据上运行MapReduce任务，并可以通过常用的工具和shell脚本访问GlusterFS上的数据。</li>
<li>主动自我修复：GlusterFS卷可以在宕机恢复之后自动从备份服务器上恢复数据。</li>
<li>Granular锁：允许在对大文件的自我修复过程中访问数据，这个功能对于把GlusterFS作为虚拟机磁盘镜像存储服务器时及其重要。</li>
<li>改进的复制策略：系统在写入数据时，只有当用户指定的备份数量的写入操作都完成时才返回。该功能为用户提供了在数据安全性和性能之间做权衡的能力。</li>
</ol>
<hr>
<h4 id="CentOS7-配置："><a href="#CentOS7-配置：" class="headerlink" title="CentOS7 配置："></a>CentOS7 配置：</h4><p><a href="https://wiki.centos.org/zh/HowTos/GlusterFSonCentOS" target="_blank" rel="noopener">https://wiki.centos.org/zh/HowTos/GlusterFSonCentOS</a>  </p>
<hr>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/19/yaf-e4-bd-bf-e7-94-a8-e6-b3-a8-e6-84-8f-e4-ba-8b-e9-a1-b9/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/19/yaf-e4-bd-bf-e7-94-a8-e6-b3-a8-e6-84-8f-e4-ba-8b-e9-a1-b9/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">Yaf 使用注意事项</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-19 09:13:14" itemprop="dateCreated datePublished" datetime="2017-04-19T09:13:14+08:00">2017-04-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:24:02" itemprop="dateModified" datetime="2018-12-12T17:24:02+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="配置文件格式"><a href="#配置文件格式" class="headerlink" title="配置文件格式"></a>配置文件格式</h3><p>需要仔细校对，第二个section中的<code>product</code>是和 php.ini 中的 <strong><code>yaf.envrion</code></strong> 配置项的值对应。并且common 节一定要继承自 common section，否则需要把common section 的配置写到 product 中。 如果 php.ini 中 yaf.use_namespace:设置为1的话，表示开启了命名空间（默认不开启），则在读取配置文件时，也要相应的在前面加上命名空间的名称（比如Yaf_Application要变成YafApplication），否则会提示 <code>Class &#39;Yaf_Application&#39; not found</code></p>
<pre><code>[ps2id id=&apos;configure_struct&apos; target=&apos;&apos;/]
[common]
application.directory = APPLICATION_PATH  &quot;/application&quot;
application.dispatcher.catchException = TRUE

[dev : common]
database.dsn = &apos;mysql:host=127.0.0.1;dbname=test&apos;
database.host = &apos;localhost&apos;
database.user = &apos;db_user&apos;
database.pwd = &apos;db_password&apos;
</code></pre><h3 id="配置文件调用示例"><a href="#配置文件调用示例" class="headerlink" title="配置文件调用示例"></a>配置文件调用示例</h3><p>Model 用于提供数据访问的各种方法，这里示例是在 /application/models/User.php 下面</p>
<pre><code>private $conf = null;
function __construct()
{
    $this-&gt;conf = Yaf_Application::app()-&gt;getConfig();
}

/**
 * List 10 Users
 */
function listUser(){
    $arr_users = array();

    $dsn = $this-&gt;conf-&gt;database-&gt;dsn;
    $db_user = $this-&gt;conf-&gt;database-&gt;user;
    $db_pwd = $this-&gt;conf-&gt;database-&gt;pwd;
    $sql = &apos;select email,password from users limit 10&apos;;
    try{
        $pdo = new PDO($dsn,$db_user,$db_pwd);
        if ($pdo){
            $stmt = $pdo-&gt;prepare($sql);
            $stmt-&gt;execute();
            $arr_data = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
            foreach ($arr_data as $datum){
                $arr_users[] = array(
                    &apos;email&apos;=&gt;$datum[&apos;email&apos;],
                    &apos;pwd&apos;=&gt;$datum[&apos;pwd&apos;],
                );
            }
        }
    }catch (PDOException $exception){
        throw  new PDOException(&apos;PDO Exception: &apos; . $exception-&gt;getMessage());
    }catch (Exception $exception){
        throw new Exception(&apos;Unknowing Exception: &apos; . $exception-&gt;getMessage());
    }

    return $arr_users;
}
</code></pre><hr>
<h3 id="调用外部-第三方类库"><a href="#调用外部-第三方类库" class="headerlink" title="调用外部/第三方类库"></a>调用外部/第三方类库</h3><p><strong>示例一</strong></p>
<pre><code>// 导入： yafoo/application/Bootstrap.php
    public function _initLoader($dispatcher){
        $loader = Yaf_Loader::getInstance();
        $loader::import(APPLICATION_PATH . &apos;/application/library/Requests/Requests.php&apos;);
    }

    // 调用时： 
    $response = Requests::get(&apos;http://www.baidu.com/?s=&apos;.$key);
</code></pre><p><strong>示例二</strong></p>
<pre><code>// Boostrap.php
$loader::import(APPLICATION_PATH . &apos;/application/library/Raven/Client.php&apos;);
Raven_Autoloader::register();

// 调用时
function someAction(){
    // code ...
    // code ....
    try{
        // some code ...
    } catch (PDOException $exception) {
        $sentry_client = new Raven_Client($sentry_url);
        $sentry_client-&gt;captureException($exception,array(
            &apos;extra&apos;=&gt;array(
                &apos;php_version&apos;=&gt;phpversion(),
                &apos;environment&apos;=&gt;Yaf_Application::app()-&gt;environ(),
            )
        ));

        throw  new PDOException(&apos;PDO Exception: &apos; . $exception-&gt;getMessage());
    }
}
</code></pre><hr>
<p><strong>如何设置多个models路径</strong></p>
<blockquote>
<p>models, controllers都支持下划线分割, 比如, 如果你是多个modules的不同model, 那么可以命名为 A_B_CModel 那么就会在models目录下的A目录的B目录里面找C</p>
</blockquote>
<h2 id="yaf控制器使用"><a href="#yaf控制器使用" class="headerlink" title="yaf控制器使用"></a>yaf控制器使用</h2><p>控制器方法 - 对用户可见的方法(即用户可以直接访问的方法)需要加上Action后缀 - 初始化类的方法为init，不是__construct</p>
<h3 id="独立文件定义操作-方法"><a href="#独立文件定义操作-方法" class="headerlink" title="独立文件定义操作(方法)"></a>独立文件定义操作(方法)</h3><p><strong>1、作用：为了分解大的控制器，让代码更加清晰</strong> <strong>2、使用方法</strong> <strong>（1）在控制器中绑定操作(即将操作绑定到某个操作类上)</strong></p>
<pre><code>class TestController extends YafController_Abstract
{
    public $actions = array(
        &apos;index&apos;=&gt;&apos;actions/index.php&apos;,
        &apos;add&apos;=&gt;&apos;actions/add.php&apos;,
        &apos;detail&apos;=&gt;&apos;actions/detail.php&apos;  
    );
}
</code></pre><p><strong>（2）定义操作类</strong></p>
<pre><code>class DetailAction extends YafAction_Abstract
{
    public function execute()
    {
        var_dump($this-&gt;getRequest()-&gt;getParam(&apos;id&apos;));
    }
}
</code></pre><p><strong>3、定义操作类</strong></p>
<ul>
<li>- 操作类位置：一般在application/actions下面，如detail.php(application/actions/detail.php)</li>
<li>- 操作类命名：必须以Action为后缀，如DetailAction</li>
<li>- 继承：继承自YafAction_abstract</li>
<li>- 必须实现的方法：execute,因为其父类YafAction_abstract是一个抽象类，必须实现抽象方法execute</li>
<li>- 可以使用的父类方法：不仅可以使用YafAction_abstract的方法，还可以继承YafController_Abstract的方法(因为YafAction_abstract继承自YafController_Abstract)</li>
</ul>
<h3 id="三、控制器基类YafController-Abstract"><a href="#三、控制器基类YafController-Abstract" class="headerlink" title="三、控制器基类YafController_Abstract"></a>三、控制器基类YafController_Abstract</h3><p><strong>1、初始化操作</strong></p>
<ul>
<li>- init:初始化操作(如初始化实例变量，在yaf中替代__construct的功能)</li>
<li>- initView:初始化视图</li>
</ul>
<p><strong>2、视图相关操作</strong></p>
<ul>
<li>(1)getViewpath:获取视图文件目录，默认在application/views下面，也可以通过setViewpath设置修改</li>
<li>(2)setViewpath:设置视图文件目录</li>
<li>(3)getView:获取当前视图对象</li>
<li>(4)display:渲染一个视图模板, 并直接输出给请求端</li>
<li>(5)render:渲染视图模板, 得到渲染结果</li>
</ul>
<p><strong>3、获取请求与响应对象</strong></p>
<ul>
<li>- getRequest:获取当前请求对象，那么它就可以调用request对象所有的方法</li>
<li><p>- getResponse:获取当前响应对象，那么它就可以调用response对象所有的方法</p>
<p>class TestController extends YafController_Abstract</p>
<pre><code>{
    public function testAction()
    {
        $id = $this-&gt;getRequest()-&gt;getParam(&apos;id&apos;);
        $response = $this-&gt;getResponse();
        $response-&gt;setHeader(&apos;content-type&apos;, &apos;application/json&apos;);
        $json = json_encode(array(&apos;id&apos;=&gt;$id, &apos;message&apos;=&gt;&apos;success&apos;));
        $response-&gt;setBody($json);
        //$response-&gt;response();
    }
}
</code></pre></li>
</ul>
<p>注：在浏览器中输入：<a href="http://www.domain.com/test/test/id/123，即可输出：{&quot;id&quot;:&quot;123&quot;,&quot;message&quot;:&quot;success&quot;}" target="_blank" rel="noopener">http://www.domain.com/test/test/id/123，即可输出：{&quot;id&quot;:&quot;123&quot;,&quot;message&quot;:&quot;success&quot;}</a> <strong>4、获取当前请求相关的参数</strong> - getModuleName:获取当前模块名(如果想获取当前控制器名或方法名，可以使用request对象来获取) 获取当前路由参数的简写方式：</p>
<pre><code>public function testAction($name, $id)
{
        echo $name;        //相当于echo $this-&gt;getRequest()-&gt;getParam(&apos;name&apos;);
        echo $id;          //相当于echo $this-&gt;getRequest()-&gt;getParam(&apos;id&apos;);
}
</code></pre><p>在浏览器中输入：<a href="http://www.doamin.com/test/test/id/123/name/shixinke" target="_blank" rel="noopener">http://www.doamin.com/test/test/id/123/name/shixinke</a> 得到输出内容：shixinke 123 <strong>5、页面跳转</strong> - forword : 跳转到某个控制器的某个方法，不会立即跳转，会继续执行它后面的内容 - redirect : 跳转到一个uri 例如：登录的权限控制 <strong>(1)使用forward</strong></p>
<pre><code>class IndexController extends YafController_Abstract
{
    public function indexAction(){   
         $logined = $_SESSION[&quot;userId&quot;];
         if (!$logined) {
             $this-&gt;forward(&quot;login&quot;, array(&quot;from&quot; =&gt; &quot;Index&quot;)); // 跳转到当前模块的login操作
             return FALSE;  //立即返回就不会执行后面的内容了
         }

         //显示内容
    }

    public function loginAction() {
         echo &quot;login, redirected from &quot;, $this-&gt;_request-&gt;getParam(&quot;from&quot;) , &quot; action&quot;;
    }
}
?&gt;
</code></pre><p>注:如果要跳转到其他模块，$this-&gt;forward(‘admin’, ‘login’, ‘index’, array(‘from’=&gt;’index’)); //跳转到admin模块的login控制器的index方法 <strong>(2)使用redirect</strong></p>
<pre><code>public function IndexAction()
{
    $logined = $_SESSION[&apos;userId&apos;];
    if (!$logined) {
    $this-&gt;redirect(&apos;http://www.domain.com/admin/login/index&apos;)); // 跳转到http://www.domain.com/admin/login/index这个地址
    return FALSE;  //立即返回就不会执行后面的内容了
    }

}
</code></pre><h3 id="四、错误处理"><a href="#四、错误处理" class="headerlink" title="四、错误处理"></a>四、错误处理</h3><p><strong>1、通过ErrorController这个控制器来捕获异常与错误</strong> 首先得在启动文件中开启异常捕获：</p>
<pre><code>YafDispatcher::getInstance()-&gt;catchException(true);
</code></pre><p>错误控制器：</p>
<pre><code>    class ErrorController extends YafController_Abstract
    {
        /**
         * 也可通过$request-&gt;getException()获取到发生的异常
         */
        public function errorAction($exception)
        {
            $constArr = array(
                YAFERRNOTFOUNDMODULE,
                YAFERRNOTFOUNDCONTROLLER,
                YAFERRDISPATCH_FAILED,
                YAFERRNOTFOUNDACTION,
                YAFERRNOTFOUNDVIEW
            );
            $err = $exception-&gt;getCode();
            if (in_array($err, $constArr)) {
                $code = 404;
                $message = &apos;请求的页面不存在&apos;;
            } else {
                $code = 500;
                $message = &apos;系统出错&apos;;
            }
            if (ENV == &apos;DEV&apos;) {
                $message = $exception-&gt;getMessage();
            }
            //记录日志
            //ajax输出或显示错误模板
            $this-&gt;getView()-&gt;assign(&apos;message&apos;, $message);
        }
    }
configure_struct
</code></pre><p><strong>2、通过YafDispatcher的setErrorHandler来捕获错误与异常</strong> 在启动文件中定义一个appErrorHandler的函数，并在_initRoute()中添加相应的捕获代码</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/17/e4-bd-bf-e7-94-a8-xdebug-e8-b0-83-e8-af-95php-e7-9a-84-e6-8a-80-e5-b7-a7/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/17/e4-bd-bf-e7-94-a8-xdebug-e8-b0-83-e8-af-95php-e7-9a-84-e6-8a-80-e5-b7-a7/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">使用 xdebug调试PHP的技巧</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 20:40:28" itemprop="dateCreated datePublished" datetime="2017-04-17T20:40:28+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:05:36" itemprop="dateModified" datetime="2018-12-12T17:05:36+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>作者：许胜斌 链接：<a href="https://www.zhihu.com/question/20348619/answer/101893104" target="_blank" rel="noopener">https://www.zhihu.com/question/20348619/answer/101893104</a> 来源：知乎 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p>我目前遇到的最让我称赞的debug方式是：<strong>xdebug</strong>的</p>
<pre><code>xdebug_start_trace();
/* 业务代码     */
xdebug_stop_trace();
</code></pre><p>他解决了我长久以来一个代码调试问题：比如有以下几个场景： 1、一个有几百行的函数，里面有很多return，现在函数异常返回了，但是我不知道是从哪一行返回的，这时候呢，我一般的做法都是每一行echo();die();太费事了。 2、接触一个新的框架，代码执行出现异常，怎么办呢，肯定也是一行一行的echo();die(); 3、想学习一个新框架，想知道代码的执行轨迹：执行了哪些类、调用了哪些类的方法，等等。 现在呢，xdebug的代码跟踪，能帮我们轻松解决上面的问题。 <strong>xdebug的安装</strong> （网上我看到了很多的都是在说xdebug、phpstorm、chrome咋配合起来远程调试，搞得大家好像觉得xdebug用起来那么费事，那么高级，其实没必要）： 1、安装php xdebug扩展（不再细说） 2、配置：这里只讲代码跟踪相关的配置：</p>
<pre><code>cat /etc/php.d/xdebug.ini
extension=/usr/lib64/php/modules/xdebug.so 
;代码跟踪日志文件位置,注意要先新建这个traces目录，并设置777
xdebug.trace_output_dir = /tmp/traces
;代码跟踪日志文件格式 
xdebug.trace_output_name = trace.%c.%p
;trace中显示函数的参数值，这个很有用，待会细说
xdebug.collect_params = 4
xdebug.collect_includes = On
xdebug.collect_return = On
xdebug.show_mem_delta = On
</code></pre><p>  安装好之后，代码执行明细(trace)，就存放在/tmp/traces目录下了:   <img src="https://tech.msla.top/wp-content/uploads/2018/04/d2006b7fc37cc5a97e300655c797e90b_b.png" alt=""> 我截取一段trace日志，大家看下，就能感知到这个用法的方便了： 1、显示了参数的值：就这一点，我想就会节省我们phper很多的调试时间（默认不显示参数值，只显示调用的函数。需要添加xdebug.collect_params这个配置） <img src="https://tech.msla.top/wp-content/uploads/2018/04/972289d2659f965081cc0ac2e8a8de02_b.png" alt=""> 1、显示了参数的值：就这一点，我想就会节省我们phper很多的调试时间（默认不显示参数值，只显示调用的函数。需要添加xdebug.collect_params这个配置） 2、显示了代码的执行轨迹。类似于c语言的单步调试吧。 就这些了，反正用了xdebug，我是觉得debug的时候节省了大量时间，分享给大家，希望对你们也有帮助。 ps：如果大家都xdebug的安装有困惑，可以参考<a href="https://link.zhihu.com/?target=http%3A//www.ibm.com/developerworks/cn/opensource/os-php-xdebug/index.html" target="_blank" rel="noopener">http://www.ibm.com/developerworks/cn/opensource/os-php-xdebug/index.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/17/e5-a6-82-e4-bd-95-e4-bc-98-e9-9b-85-e7-9a-84-e8-be-93-e5-87-baphp-e8-b0-83-e8-af-95-e4-bf-a1-e6-81-af/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/17/e5-a6-82-e4-bd-95-e4-bc-98-e9-9b-85-e7-9a-84-e8-be-93-e5-87-baphp-e8-b0-83-e8-af-95-e4-bf-a1-e6-81-af/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">如何优雅的输出PHP调试信息</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 20:38:52" itemprop="dateCreated datePublished" datetime="2017-04-17T20:38:52+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:08:58" itemprop="dateModified" datetime="2018-12-12T17:08:58+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/大前端！/" itemprop="url" rel="index"><span itemprop="name">大前端！</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/大前端！/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何优雅的输出PHP调试信息"><a href="#如何优雅的输出PHP调试信息" class="headerlink" title="如何优雅的输出PHP调试信息"></a><a href="http://www.cnblogs.com/gidot/p/4307709.html" target="_blank" rel="noopener">如何优雅的输出PHP调试信息</a></h2><p>经常因为出现紧急bug而被老板骂的同事，为了更快的修复而直接利用线上的错误环境现场debug，并直接在页面上echo和dump。结果被老板发现了，又是一通臭骂。那么有没有什么办法更优雅的输出PHP调试信息呢？ 这里提供一个方案：利用浏览器调试模式的Console 1，先定义一个php函数：</p>
<p><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></p>
<p> 1 function console($log=’’)<br> 2 {<br> 3     switch (empty($log)) {<br> 4         case False:<br> 5             $out = json_encode($log);<br> 6             $GLOBALS[‘console’] .= ‘console.log(‘.$out.’);’;<br> 7             break;<br> 8<br> 9         default:<br>10             echo ‘<script type="text/javascript">‘.$GLOBALS[‘console’].’</script>‘;<br>11     }<br>12 }</p>
<p><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码"></p>
<pre><code>2，在需要调试的地方直接调用它，递交的参数可以是字符串，也可以是数组。 ![](https://tech.msla.top/wp-content/uploads/2018/04/012220393931537.png)   3，在适当的位置调用无参数的console，用来输出调试信息，比如各类php框架入口文件的最底部 ![](https://tech.msla.top/wp-content/uploads/2018/04/012221208472406.png)   4，打开浏览器（比如chrome），载入页面后进入调试模式（比如按F12键），点击Console，你会发现所有数据都在这里等着你查阅。 ![](https://tech.msla.top/wp-content/uploads/2018/04/012221469725658-1.png)   5，其他用途 优秀的PHP开源框架ThinkPHP提供了输出运行状态的功能，你可以通过运行状态来了解某个页面在后台处理了多长时间。但是，很多人都注意到了，它是不准确的。 下面我们试着用刚刚加进来的自定义函数console在浏览器中输出真正的运行时间。 所有工作都在入口文件中完成： ![](https://tech.msla.top/wp-content/uploads/2018/04/012222279878126.png) 在所有代码的最开头，定义变量$s=microtime(true); 在console();的上面再增加console(&apos;exetime:&apos;.round(microtime(true)-$s,4)); 好了，我们来看看真正的运行时间吧： ![](https://tech.msla.top/wp-content/uploads/2018/04/012222584566118.png)   这个课题就这么简单愉快的解决了。 PS：因为这个函数用到了json来输出数组，所以要求编码为UTF-8，如果使用其它编码可能会出现未知问题，需要留意。
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/17/mongodb-e4-ba-bf-e7-ba-a7-e6-95-b0-e6-8d-ae-e9-87-8f-e7-9a-84-e6-80-a7-e8-83-bd-e6-b5-8b-e8-af-95/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/17/mongodb-e4-ba-bf-e7-ba-a7-e6-95-b0-e6-8d-ae-e9-87-8f-e7-9a-84-e6-80-a7-e8-83-bd-e6-b5-8b-e8-af-95/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">Mongodb亿级数据量的性能测试</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-17 13:41:34" itemprop="dateCreated datePublished" datetime="2017-04-17T13:41:34+08:00">2017-04-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:20:50" itemprop="dateModified" datetime="2018-12-12T17:20:50+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>进行了一下Mongodb亿级数据量的性能测试，分别测试如下几个项目：</p>
<p> （所有插入都是单线程进行，所有读取都是多线程进行）</p>
<p>1） 普通插入性能 （插入的数据每条大约在1KB左右） 2） 批量插入性能 （使用的是官方C#客户端的InsertBatch），这个测的是批量插入性能能有多少提高 3） 安全插入功能 （确保插入成功，使用的是SafeMode.True开关），这个测的是安全插入性能会差多少 4） 查询一个索引后的数字列，返回10条记录（也就是10KB）的性能，这个测的是索引查询的性能 5） 查询两个索引后的数字列，返回10条记录（每条记录只返回20字节左右的2个小字段）的性能，这个测的是返回小数据量以及多一个查询条件对性能的影响 6） 查询一个索引后的数字列，按照另一个索引的日期字段排序（索引建立的时候是倒序，排序也是倒序），并且Skip100条记录后返回10条记录的性能，这个测的是Skip和Order对性能的影响 7） 查询100条记录（也就是100KB）的性能（没有排序，没有条件），这个测的是大数据量的查询结果对性能的影响 8） 统计随着测试的进行，总磁盘占用，索引磁盘占用以及数据磁盘占用的数量 并且每一种测试都使用单进程的Mongodb和同一台服务器开三个Mongodb进程作为Sharding（每一个进程大概只能用7GB左右的内存）两种方案 其实对于Sharding，虽然是一台机器放3个进程，但是在查询的时候每一个并行进程查询部分数据，再有运行于另外一个机器的mongos来汇总数据，理论上来说在某些情况下性能会有点提高 基于以上的种种假设，猜测某些情况性能会下降，某些情况性能会提高，那么来看一下最后的测试结果怎么样？ 备注：测试的存储服务器是 E5620  @ 2.40GHz，24GB内存，CentOs操作系统，打压机器是E5504 @ 2.0GHz，4GB内存，Windows Server 2003操作系统，两者千兆网卡直连。 <img src="https://tech.msla.top/wp-content/uploads/2018/04/mongodb_erformance-462x1024.png" alt="" title="mongodb_erformance"> 从这个测试可以看出，对于单进程的方式： 1） Mongodb的非安全插入方式，在一开始插入性能是非常高的，但是在达到了两千万条数据之后性能骤减，这个时候恰巧是服务器24G内存基本占满的时候（随着测试的进行mongodb不断占据内存，一直到操作系统的内存全部占满），也就是说Mongodb的内存映射方式，使得数据全部在内存中的时候速度飞快，当部分数据需要换出到磁盘上之后，性能下降很厉害。（这个性能其实也不算太差，因为我们对三个列的数据做了索引，即使在内存满了之后每秒也能插入2MB的数据，在一开始更是每秒插入25MB数据）。Foursquare其实也是把Mongodb当作带持久化的内存数据库使用的，只是在查不到达到内存瓶颈的时候Sharding没处理好。 2） 对于批量插入功能，其实是一次提交一批数据，但是相比一次一条插入性能并没有提高多少，一来是因为网络带宽已经成为了瓶颈，二来我想写锁也会是一个原因。 3） 对于安全插入功能，相对来说比较稳定，不会波动很大，我想可能是因为安全插入是确保数据直接持久化到磁盘的，而不是插入内存就完事。 4） 对于一列条件的查询，性能一直比较稳定，别小看，每秒能有8000-9000的查询次数，每次返回10KB，相当于每秒查询80MB数据，而且数据库记录是2亿之后还能维持这个水平，性能惊人。 5） 对于二列条件返回小数据的查询，总体上性能会比4）好一点，可能返回的数据量小对性能提高比较大，但是相对来说性能波动也厉害一点，可能多了一个条件就多了一个从磁盘换页的机会。 6） 对于一列数据外加Sort和Skip的查询，在数据量大了之后性能明显就变差了（此时是索引数据量超过内存大小的时候，不知道是否有联系），我猜想是Skip比较消耗性能，不过和4）相比性能也不是差距特别大。 7） 对于返回大数据的查询，一秒瓶颈也有800次左右，也就是80M数据，这就进一步说明了在有索引的情况下，顺序查询和按条件搜索性能是相差无几的，这个时候是IO和网络的瓶颈。 8） 在整个过程中索引占的数据量已经占到了总数据量的相当大比例，在达到1亿4千万数据量的时候，光索引就可以占据整个内存，此时查询性能还是非常高，插入性能也不算太差，mongodb的性能确实很牛。 那么在来看看Sharding模式有什么亮点： 1） 非安全插入和单进程的配置一样，在内存满了之后性能急剧下降。安全插入性能和单进程相比慢不少，但是非常稳定。 2） 对于一个条件和两个条件的查询，性能都比较稳定，但条件查询性能相当于单进程的一半，但是在多条件下有的时候甚至会比单进程高一点。我想这可能是某些时候数据块位于两个Sharding，这样Mongos会并行在两个Sharding查询，然后在把数据进行合并汇总，由于查询返回的数据量小，网络不太可能成为瓶颈了，使得Sharding才有出头的机会。 3） 对于Order和Skip的查询，Sharding方式的差距就出来了，我想主要性能损失可能在Order，因为我们并没有按照排序字段作为Sharding的Key，使用的是_id作为Key，这样排序就比较难进行。 4） 对于返回大数据量的查询，Sharding方式其实和单进程差距不是很大，我想数据的转发可能是一个性能损耗的原因（虽然mongos位于打压机本机，但是数据始终是转手了一次）。 5） 对于磁盘空间的占用，两者其实是差不多的，其中的一些差距可能是因为多个进程都会多分配一点空间，加起来有的时候会比单进程多占用点磁盘（而那些占用比单进程少的地方其实是开始的编码错误，把实际数据大小和磁盘文件占用大小搞错了）。 测试最后的各个Sharding分布情况如下：</p>
<pre><code>{
    &quot;sharded&quot;:true,
    &quot;ns&quot;:&quot;testdb.test&quot;,
    &quot;count&quot;:209766143,
    &quot;size&quot;:214800530672,
    &quot;avgObjSize&quot;:1024.0000011441311,
    &quot;storageSize&quot;:222462757776,
    &quot;nindexes&quot;:4,
    &quot;nchunks&quot;:823,
    &quot;shards&quot;:{
        &quot;shard0000&quot;:{
            &quot;ns&quot;:&quot;testdb.test&quot;,
            &quot;count&quot;:69474248,
            &quot;size&quot;:71141630032,
            &quot;avgObjSize&quot;:1024.0000011515058,
            &quot;storageSize&quot;:74154252592,
            &quot;numExtents&quot;:65,
            &quot;nindexes&quot;:4,
            &quot;lastExtentSize&quot;:2146426864,
            &quot;paddingFactor&quot;:1,
            &quot;flags&quot;:1,
            &quot;totalIndexSize&quot;:11294125824,
            &quot;indexSizes&quot;:{
                &quot;_id_&quot;:2928157632,
                &quot;Number_1&quot;:2832745408,
                &quot;Number1_1&quot;:2833974208,
                &quot;Date_-1&quot;:2699248576
            },
            &quot;ok&quot;:1
        },
        &quot;shard0001&quot;:{
            &quot;ns&quot;:&quot;testdb.test&quot;,
            &quot;count&quot;:70446092,
            &quot;size&quot;:72136798288,
            &quot;avgObjSize&quot;:1024.00000113562,
            &quot;storageSize&quot;:74154252592,
            &quot;numExtents&quot;:65,
            &quot;nindexes&quot;:4,
            &quot;lastExtentSize&quot;:2146426864,
            &quot;paddingFactor&quot;:1,
            &quot;flags&quot;:1,
            &quot;totalIndexSize&quot;:11394068224,
            &quot;indexSizes&quot;:{
                &quot;_id_&quot;:2969355200,
                &quot;Number_1&quot;:2826453952,
                &quot;Number1_1&quot;:2828403648,
                &quot;Date_-1&quot;:2769855424
            },
            &quot;ok&quot;:1
        },
        &quot;shard0002&quot;:{
            &quot;ns&quot;:&quot;testdb.test&quot;,
            &quot;count&quot;:69845803,
            &quot;size&quot;:71522102352,
            &quot;avgObjSize&quot;:1024.00000114538,
            &quot;storageSize&quot;:74154252592,
            &quot;numExtents&quot;:65,
            &quot;nindexes&quot;:4,
            &quot;lastExtentSize&quot;:2146426864,
            &quot;paddingFactor&quot;:1,
            &quot;flags&quot;:1,
            &quot;totalIndexSize&quot;:11300515584,
            &quot;indexSizes&quot;:{
                &quot;_id_&quot;:2930942912,
                &quot;Number_1&quot;:2835243968,
                &quot;Number1_1&quot;:2835907520,
                &quot;Date_-1&quot;:2698421184
            },
            &quot;ok&quot;:1
        }
    },
    &quot;ok&quot;:1
}
</code></pre><p>  虽然在最后由于时间的关系，没有测到10亿级别的数据量，但是通过这些数据已经可以证明Mongodb的性能是多么强劲了。另外一个原因是，在很多时候可能数据只达到千万我们就会对库进行拆分，不会让一个库的索引非常庞大。在测试的过程中还发现几个问题需要值得注意： 1） 在数据量很大的情况下，对服务进行重启，那么服务启动的初始化阶段，虽然可以接受数据的查询和修改，但是此时性能很差，因为mongodb会不断把数据从磁盘换入内存，此时的IO压力非常大。 2） 在数据量很大的情况下，如果服务没有正常关闭，那么Mongodb启动修复数据库的时间非常可观，在1.8中退出的-dur貌似可以解决这个问题，据官方说对读取没影响，写入速度会稍稍降低，有空我也会再进行下测试。 3） 在使用Sharding的时候，Mongodb时不时会对数据拆分搬迁，这个时候性能下降很厉害，虽然从测试图中看不出（因为我每一次测试都会测试比较多的迭代次数），但是我在实际观察中可以发现，在搬迁数据的时候每秒插入性能可能会低到几百条。其实我觉得能手动切分数据库就手动切分或者手动做历史库，不要依赖这种自动化的Sharding，因为一开始数据就放到正确的位置比分隔再搬迁效率不知道高多少。个人认为Mongodb单数据库存储不超过1亿的数据比较合适，再大还是手动分库吧。 4） 对于数据的插入，如果使用多线程并不会带来性能的提高，反而还会下降一点性能（并且可以在http接口上看到，有大量的线程处于等待）。 5） 在整个测试过程中，批量插入的时候遇到过几次连接被远程计算机关闭的错误，怀疑是有的时候Mongodb不稳定关闭了连接，或是官方的C#客户端有BUG，但是也仅仅是在数据量特别大的时候遇到几次。</p>
<hr>
<p>最新补充：在之后我又进行了几天测试，把测试数据量进一步加大到5亿，总磁盘占用超过500G，发现和2亿数据量相比，所有性能都差不多，只是测试6和测试7在超过2亿级别数据之后，每400万记录作为一个循环，上下波动30%的性能，非常有规律。 文章来源： <a href="http://www.taocms.org/435.html" target="_blank" rel="noopener">http://www.taocms.org/435.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hero.triple.net.cn/2017/04/12/php-tips/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="$$ Welcome $$">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Technician">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/04/12/php-tips/" class="post-title-link" itemprop="https://hero.triple.net.cn/page/11/index.html">PHP Tips</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-04-12 09:37:05" itemprop="dateCreated datePublished" datetime="2017-04-12T09:37:05+08:00">2017-04-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-12 17:27:29" itemprop="dateModified" datetime="2018-12-12T17:27:29+08:00">2018-12-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术分类/" itemprop="url" rel="index"><span itemprop="name">技术分类</span></a></span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="php中实现后台执行的方法："><a href="#php中实现后台执行的方法：" class="headerlink" title="php中实现后台执行的方法："></a>php中实现后台执行的方法：</h4><pre><code>ignore_user_abort(true); // 后台运行
set_time_limit(0); // 取消脚本运行时间的超时上限
</code></pre><hr>
<h4 id="PHP-连接-RedisServer-时提示-Message-Redis-connect-connect-failed-Permission-denied"><a href="#PHP-连接-RedisServer-时提示-Message-Redis-connect-connect-failed-Permission-denied" class="headerlink" title="PHP 连接 RedisServer 时提示 Message: Redis::connect(): connect() failed: Permission denied"></a>PHP 连接 RedisServer 时提示 <code>Message: Redis::connect(): connect() failed: Permission denied</code></h4><p>第一次出现是连接远程的 Redis 服务器。之后尝试在本地也安装了一个 redis-server，然后手动启动，并连接——错误依旧 <strong>解决方法：</strong> 首先保证当前服务器已经安装了与当前执行的 PHP 版本对应的 Redis 扩展 然后到命令行执行：</p>
<pre><code>/usr/sbin/setsebool httpd_can_network_connect=1
</code></pre><p>参考来源： <a href="http://stackoverflow.com/questions/8765848/troubleshooting-permission-denied-when-attempting-to-connect-to-redis-from-php" target="_blank" rel="noopener">http://stackoverflow.com/questions/8765848/troubleshooting-permission-denied-when-attempting-to-connect-to-redis-from-php</a></p>
<hr>
<h4 id="PHP-生成随机不可逆字符"><a href="#PHP-生成随机不可逆字符" class="headerlink" title="PHP 生成随机不可逆字符"></a>PHP 生成随机不可逆字符</h4><p>比如用作抵御csrf攻击的token</p>
<pre><code>// 命令行执行即可看到结果
php -r &quot;echo sha1(uniqid(rand(), true));&quot;
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description">$$ Welcome $$</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">174</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">214</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script type="text/javascript" color="0,0,255" opacity="0.5" zindex="-1" count="69" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>


  

</body>
</html>
